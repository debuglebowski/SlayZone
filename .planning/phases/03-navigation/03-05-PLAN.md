---
phase: 03-navigation
plan: 05
type: execute
wave: 3
depends_on: ["03-02", "03-04"]
files_modified:
  - src/renderer/src/components/dialogs/UserSettingsDialog.tsx
  - src/renderer/src/components/sidebar/AppSidebar.tsx
  - src/renderer/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User settings accessible from sidebar"
    - "Settings dialog shows tags management"
    - "User can create, edit, delete tags"
    - "Database path displayed (read-only)"
  artifacts:
    - path: "src/renderer/src/components/dialogs/UserSettingsDialog.tsx"
      provides: "User settings modal"
      contains: "tags"
    - path: "src/renderer/src/components/sidebar/AppSidebar.tsx"
      provides: "Settings button"
      contains: "onSettings"
  key_links:
    - from: "src/renderer/src/components/dialogs/UserSettingsDialog.tsx"
      to: "window.api.tags"
      via: "IPC calls"
      pattern: "window.api.tags"
---

<objective>
Build user settings dialog with tags management. Add settings button to sidebar.

Purpose: Global app configuration (NAV-06)
Output: User settings dialog with tag CRUD
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-navigation/03-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create UserSettingsDialog with tags management</name>
  <files>src/renderer/src/components/dialogs/UserSettingsDialog.tsx</files>
  <action>
Create `src/renderer/src/components/dialogs/UserSettingsDialog.tsx`:

```tsx
import { useState, useEffect } from "react"
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Separator } from "@/components/ui/separator"
import { ColorPicker } from "@/components/ui/color-picker"
import type { Tag } from "../../../../shared/types/database"

interface UserSettingsDialogProps {
  open: boolean
  onOpenChange: (open: boolean) => void
}

export function UserSettingsDialog({ open, onOpenChange }: UserSettingsDialogProps) {
  const [tags, setTags] = useState<Tag[]>([])
  const [newTagName, setNewTagName] = useState("")
  const [newTagColor, setNewTagColor] = useState("#6b7280")
  const [editingTag, setEditingTag] = useState<Tag | null>(null)
  const [dbPath, setDbPath] = useState<string>("")

  useEffect(() => {
    if (open) {
      loadData()
    }
  }, [open])

  const loadData = async () => {
    const [loadedTags, path] = await Promise.all([
      window.api.tags.getTags(),
      window.api.settings.get("database_path"),
    ])
    setTags(loadedTags)
    setDbPath(path ?? "Default location (userData)")
  }

  const handleCreateTag = async () => {
    if (!newTagName.trim()) return
    const tag = await window.api.tags.createTag({
      name: newTagName.trim(),
      color: newTagColor,
    })
    setTags([...tags, tag])
    setNewTagName("")
    setNewTagColor("#6b7280")
  }

  const handleUpdateTag = async () => {
    if (!editingTag || !editingTag.name.trim()) return
    const updated = await window.api.tags.updateTag({
      id: editingTag.id,
      name: editingTag.name.trim(),
      color: editingTag.color,
    })
    setTags(tags.map((t) => (t.id === updated.id ? updated : t)))
    setEditingTag(null)
  }

  const handleDeleteTag = async (id: string) => {
    await window.api.tags.deleteTag(id)
    setTags(tags.filter((t) => t.id !== id))
  }

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="max-w-lg">
        <DialogHeader>
          <DialogTitle>Settings</DialogTitle>
        </DialogHeader>

        <div className="space-y-6">
          {/* Tags Section */}
          <div className="space-y-4">
            <Label className="text-base font-semibold">Tags</Label>

            {/* Existing tags */}
            <div className="space-y-2">
              {tags.map((tag) => (
                <div key={tag.id} className="flex items-center gap-2">
                  {editingTag?.id === tag.id ? (
                    <>
                      <div
                        className="w-4 h-4 rounded-full flex-shrink-0"
                        style={{ backgroundColor: editingTag.color }}
                      />
                      <Input
                        value={editingTag.name}
                        onChange={(e) =>
                          setEditingTag({ ...editingTag, name: e.target.value })
                        }
                        className="flex-1 h-8"
                      />
                      <Button size="sm" variant="ghost" onClick={handleUpdateTag}>
                        Save
                      </Button>
                      <Button
                        size="sm"
                        variant="ghost"
                        onClick={() => setEditingTag(null)}
                      >
                        Cancel
                      </Button>
                    </>
                  ) : (
                    <>
                      <div
                        className="w-4 h-4 rounded-full flex-shrink-0"
                        style={{ backgroundColor: tag.color }}
                      />
                      <span className="flex-1">{tag.name}</span>
                      <Button
                        size="sm"
                        variant="ghost"
                        onClick={() => setEditingTag({ ...tag })}
                      >
                        Edit
                      </Button>
                      <Button
                        size="sm"
                        variant="ghost"
                        className="text-destructive"
                        onClick={() => handleDeleteTag(tag.id)}
                      >
                        Delete
                      </Button>
                    </>
                  )}
                </div>
              ))}
            </div>

            {/* Add new tag */}
            <div className="flex gap-2 items-end">
              <div className="flex-1 space-y-1">
                <Label htmlFor="new-tag" className="text-xs">
                  New tag
                </Label>
                <Input
                  id="new-tag"
                  value={newTagName}
                  onChange={(e) => setNewTagName(e.target.value)}
                  placeholder="Tag name"
                  onKeyDown={(e) => e.key === "Enter" && handleCreateTag()}
                />
              </div>
              <div className="space-y-1">
                <Label className="text-xs">Color</Label>
                <Input
                  type="color"
                  value={newTagColor}
                  onChange={(e) => setNewTagColor(e.target.value)}
                  className="w-12 h-9 p-1 cursor-pointer"
                />
              </div>
              <Button onClick={handleCreateTag} disabled={!newTagName.trim()}>
                Add
              </Button>
            </div>
          </div>

          <Separator />

          {/* Database Path Section */}
          <div className="space-y-2">
            <Label className="text-base font-semibold">Database</Label>
            <div className="text-sm text-muted-foreground">
              <p>Location: {dbPath}</p>
              <p className="text-xs mt-1">
                Database path can be changed via command line. Restart required.
              </p>
            </div>
          </div>
        </div>
      </DialogContent>
    </Dialog>
  )
}
```

Tags section: list existing, inline edit, add new. DB path: display only (changing requires restart per RESEARCH.md).
  </action>
  <verify>File exists with tag CRUD UI and database path display.</verify>
  <done>UserSettingsDialog with tags management created</done>
</task>

<task type="auto">
  <name>Task 2: Add settings button to sidebar and wire dialog</name>
  <files>src/renderer/src/components/sidebar/AppSidebar.tsx, src/renderer/src/App.tsx</files>
  <action>
1. Update `src/renderer/src/components/sidebar/AppSidebar.tsx` to add settings button at bottom:

Add to props interface:
```tsx
onSettings: () => void
```

Add settings button after the add project button, using SidebarFooter:
```tsx
import {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupContent,
  SidebarMenu,
  SidebarMenuItem,
} from "@/components/ui/sidebar"

// In component, wrap in SidebarFooter at end of Sidebar:
<SidebarFooter className="py-4">
  <SidebarMenu>
    <SidebarMenuItem className="flex justify-center">
      <button
        onClick={onSettings}
        className={cn(
          "w-10 h-10 rounded-lg flex items-center justify-center",
          "text-muted-foreground hover:bg-muted transition-colors"
        )}
        title="Settings"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
          <circle cx="12" cy="12" r="3"/>
        </svg>
      </button>
    </SidebarMenuItem>
  </SidebarMenu>
</SidebarFooter>
```

2. Update `src/renderer/src/App.tsx`:

Add import:
```tsx
import { UserSettingsDialog } from "@/components/dialogs/UserSettingsDialog"
```

Add state:
```tsx
const [settingsOpen, setSettingsOpen] = useState(false)
```

Update AppSidebar:
```tsx
<AppSidebar
  ...
  onSettings={() => setSettingsOpen(true)}
/>
```

Add dialog:
```tsx
<UserSettingsDialog
  open={settingsOpen}
  onOpenChange={setSettingsOpen}
/>
```
  </action>
  <verify>
- Settings gear icon visible at bottom of sidebar
- Click opens UserSettingsDialog
- Tags section shows existing tags, can add/edit/delete
- Database path displayed
  </verify>
  <done>Settings button in sidebar, UserSettingsDialog wired</done>
</task>

</tasks>

<verification>
1. Settings gear icon at bottom of sidebar
2. Click gear -> UserSettingsDialog opens
3. Can create tag with name + color
4. Can edit existing tag name
5. Can delete tag
6. Database path displayed (read-only)
7. Dialog closes cleanly
</verification>

<success_criteria>
- Settings accessible from sidebar (NAV-06)
- Tags CRUD functional
- Database path shown
- Clean UI with proper spacing
</success_criteria>

<output>
After completion, create `.planning/phases/03-navigation/03-05-SUMMARY.md`
</output>
