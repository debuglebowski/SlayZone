---
phase: 03-navigation
plan: 04
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/renderer/src/components/sidebar/ProjectItem.tsx
  - src/renderer/src/components/dialogs/CreateProjectDialog.tsx
  - src/renderer/src/components/dialogs/ProjectSettingsDialog.tsx
  - src/renderer/src/components/dialogs/DeleteProjectDialog.tsx
  - src/renderer/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Right-click project blob shows context menu"
    - "Context menu has Settings and Delete options"
    - "Create project dialog has name + color picker"
    - "Project settings dialog can edit name + color"
    - "Delete project shows confirmation with cascade warning"
  artifacts:
    - path: "src/renderer/src/components/dialogs/CreateProjectDialog.tsx"
      provides: "Project creation modal"
      contains: "ColorPicker"
    - path: "src/renderer/src/components/dialogs/ProjectSettingsDialog.tsx"
      provides: "Project edit modal"
      contains: "ColorPicker"
    - path: "src/renderer/src/components/dialogs/DeleteProjectDialog.tsx"
      provides: "Delete confirmation"
      contains: "AlertDialog"
  key_links:
    - from: "src/renderer/src/components/sidebar/ProjectItem.tsx"
      to: "src/renderer/src/components/ui/context-menu.tsx"
      via: "ContextMenuTrigger"
      pattern: "ContextMenuTrigger"
    - from: "src/renderer/src/components/dialogs/CreateProjectDialog.tsx"
      to: "src/renderer/src/components/ui/color-picker.tsx"
      via: "import"
      pattern: "ColorPicker"
---

<objective>
Build project management dialogs with context menu integration. Add right-click menu to project blobs.

Purpose: Project CRUD UI (NAV-03, NAV-04, NAV-05)
Output: Full project management via sidebar context menu
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-navigation/03-RESEARCH.md
@src/renderer/src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create project dialogs with color picker</name>
  <files>src/renderer/src/components/dialogs/CreateProjectDialog.tsx, src/renderer/src/components/dialogs/ProjectSettingsDialog.tsx, src/renderer/src/components/dialogs/DeleteProjectDialog.tsx</files>
  <action>
Create directory `src/renderer/src/components/dialogs/` and three files:

**CreateProjectDialog.tsx:**
```tsx
import { useState } from "react"
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { ColorPicker } from "@/components/ui/color-picker"
import type { Project } from "../../../../shared/types/database"

interface CreateProjectDialogProps {
  open: boolean
  onOpenChange: (open: boolean) => void
  onCreated: (project: Project) => void
}

const DEFAULT_COLORS = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899']

export function CreateProjectDialog({ open, onOpenChange, onCreated }: CreateProjectDialogProps) {
  const [name, setName] = useState("")
  const [color, setColor] = useState(DEFAULT_COLORS[0])
  const [loading, setLoading] = useState(false)

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    if (!name.trim()) return

    setLoading(true)
    try {
      const project = await window.api.db.createProject({ name: name.trim(), color })
      onCreated(project)
      setName("")
      setColor(DEFAULT_COLORS[Math.floor(Math.random() * DEFAULT_COLORS.length)])
    } finally {
      setLoading(false)
    }
  }

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>Create Project</DialogTitle>
        </DialogHeader>
        <form onSubmit={handleSubmit} className="space-y-4">
          <div className="space-y-2">
            <Label htmlFor="name">Name</Label>
            <Input
              id="name"
              value={name}
              onChange={(e) => setName(e.target.value)}
              placeholder="Project name"
              autoFocus
            />
          </div>
          <div className="space-y-2">
            <Label>Color</Label>
            <ColorPicker value={color} onChange={setColor} />
          </div>
          <div className="flex justify-end gap-2">
            <Button type="button" variant="outline" onClick={() => onOpenChange(false)}>
              Cancel
            </Button>
            <Button type="submit" disabled={!name.trim() || loading}>
              Create
            </Button>
          </div>
        </form>
      </DialogContent>
    </Dialog>
  )
}
```

**ProjectSettingsDialog.tsx:**
```tsx
import { useState, useEffect } from "react"
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { ColorPicker } from "@/components/ui/color-picker"
import type { Project } from "../../../../shared/types/database"

interface ProjectSettingsDialogProps {
  project: Project | null
  open: boolean
  onOpenChange: (open: boolean) => void
  onUpdated: (project: Project) => void
}

export function ProjectSettingsDialog({ project, open, onOpenChange, onUpdated }: ProjectSettingsDialogProps) {
  const [name, setName] = useState("")
  const [color, setColor] = useState("")
  const [loading, setLoading] = useState(false)

  useEffect(() => {
    if (project) {
      setName(project.name)
      setColor(project.color)
    }
  }, [project])

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    if (!project || !name.trim()) return

    setLoading(true)
    try {
      const updated = await window.api.db.updateProject({
        id: project.id,
        name: name.trim(),
        color,
      })
      onUpdated(updated)
    } finally {
      setLoading(false)
    }
  }

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>Project Settings</DialogTitle>
        </DialogHeader>
        <form onSubmit={handleSubmit} className="space-y-4">
          <div className="space-y-2">
            <Label htmlFor="edit-name">Name</Label>
            <Input
              id="edit-name"
              value={name}
              onChange={(e) => setName(e.target.value)}
            />
          </div>
          <div className="space-y-2">
            <Label>Color</Label>
            <ColorPicker value={color} onChange={setColor} />
          </div>
          <div className="flex justify-end gap-2">
            <Button type="button" variant="outline" onClick={() => onOpenChange(false)}>
              Cancel
            </Button>
            <Button type="submit" disabled={!name.trim() || loading}>
              Save
            </Button>
          </div>
        </form>
      </DialogContent>
    </Dialog>
  )
}
```

**DeleteProjectDialog.tsx:**
```tsx
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from "@/components/ui/alert-dialog"
import type { Project } from "../../../../shared/types/database"

interface DeleteProjectDialogProps {
  project: Project | null
  open: boolean
  onOpenChange: (open: boolean) => void
  onDeleted: () => void
}

export function DeleteProjectDialog({ project, open, onOpenChange, onDeleted }: DeleteProjectDialogProps) {
  const handleDelete = async () => {
    if (!project) return
    await window.api.db.deleteProject(project.id)
    onDeleted()
  }

  return (
    <AlertDialog open={open} onOpenChange={onOpenChange}>
      <AlertDialogContent>
        <AlertDialogHeader>
          <AlertDialogTitle>Delete Project</AlertDialogTitle>
          <AlertDialogDescription>
            This will permanently delete "{project?.name}" and all its tasks.
            This action cannot be undone.
          </AlertDialogDescription>
        </AlertDialogHeader>
        <AlertDialogFooter>
          <AlertDialogCancel>Cancel</AlertDialogCancel>
          <AlertDialogAction onClick={handleDelete} className="bg-destructive text-destructive-foreground hover:bg-destructive/90">
            Delete
          </AlertDialogAction>
        </AlertDialogFooter>
      </AlertDialogContent>
    </AlertDialog>
  )
}
```
  </action>
  <verify>All three files exist in components/dialogs/. No TypeScript errors.</verify>
  <done>Project dialogs with ColorPicker integration created</done>
</task>

<task type="auto">
  <name>Task 2: Add context menu to ProjectItem</name>
  <files>src/renderer/src/components/sidebar/ProjectItem.tsx</files>
  <action>
Update `src/renderer/src/components/sidebar/ProjectItem.tsx` to wrap with ContextMenu:

```tsx
import { cn } from "@/lib/utils"
import {
  ContextMenu,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuSeparator,
  ContextMenuTrigger,
} from "@/components/ui/context-menu"
import type { Project } from "../../../../shared/types/database"

interface ProjectItemProps {
  project: Project
  selected: boolean
  onClick: () => void
  onSettings: () => void
  onDelete: () => void
}

export function ProjectItem({ project, selected, onClick, onSettings, onDelete }: ProjectItemProps) {
  const abbrev = project.name.slice(0, 2).toUpperCase()

  return (
    <ContextMenu>
      <ContextMenuTrigger asChild>
        <button
          onClick={onClick}
          className={cn(
            "w-10 h-10 rounded-lg flex items-center justify-center",
            "text-xs font-semibold text-white transition-all",
            "hover:scale-105",
            selected && "ring-2 ring-primary ring-offset-2 ring-offset-background"
          )}
          style={{ backgroundColor: project.color }}
          title={project.name}
        >
          {abbrev}
        </button>
      </ContextMenuTrigger>
      <ContextMenuContent>
        <ContextMenuItem onSelect={onSettings}>
          Settings
        </ContextMenuItem>
        <ContextMenuSeparator />
        <ContextMenuItem onSelect={onDelete} className="text-destructive">
          Delete
        </ContextMenuItem>
      </ContextMenuContent>
    </ContextMenu>
  )
}
```

Added onSettings and onDelete props. Context menu triggers these via onSelect.
  </action>
  <verify>Right-click on project blob shows context menu with Settings and Delete options.</verify>
  <done>ProjectItem has right-click context menu</done>
</task>

<task type="auto">
  <name>Task 3: Wire dialogs into App.tsx</name>
  <files>src/renderer/src/App.tsx</files>
  <action>
Update `src/renderer/src/App.tsx`:

1. Add imports:
```tsx
import { CreateProjectDialog } from "@/components/dialogs/CreateProjectDialog"
import { ProjectSettingsDialog } from "@/components/dialogs/ProjectSettingsDialog"
import { DeleteProjectDialog } from "@/components/dialogs/DeleteProjectDialog"
```

2. Add state for project dialogs:
```tsx
// Project dialog state
const [createProjectOpen, setCreateProjectOpen] = useState(false)
const [editingProject, setEditingProject] = useState<Project | null>(null)
const [deletingProject, setDeletingProject] = useState<Project | null>(null)
```

3. Add handlers:
```tsx
const handleProjectCreated = (project: Project): void => {
  setProjects([...projects, project])
  setSelectedProjectId(project.id)
  setCreateProjectOpen(false)
}

const handleProjectUpdated = (project: Project): void => {
  setProjects(projects.map((p) => (p.id === project.id ? project : p)))
  setEditingProject(null)
}

const handleProjectDeleted = (): void => {
  if (deletingProject) {
    setProjects(projects.filter((p) => p.id !== deletingProject.id))
    if (selectedProjectId === deletingProject.id) {
      setSelectedProjectId(projects.length > 1 ? projects[0].id : null)
    }
    setDeletingProject(null)
  }
}
```

4. Update AppSidebar props:
```tsx
<AppSidebar
  projects={projects}
  selectedProjectId={selectedProjectId}
  onSelectProject={setSelectedProjectId}
  onAddProject={() => setCreateProjectOpen(true)}
  onProjectSettings={setEditingProject}
  onProjectDelete={setDeletingProject}
/>
```

5. Update AppSidebar to pass handlers to ProjectItem (update AppSidebar.tsx):
```tsx
// In AppSidebar props interface:
onProjectSettings: (project: Project) => void
onProjectDelete: (project: Project) => void

// In ProjectItem render:
<ProjectItem
  project={project}
  selected={selectedProjectId === project.id}
  onClick={() => onSelectProject(project.id)}
  onSettings={() => onProjectSettings(project)}
  onDelete={() => onProjectDelete(project)}
/>
```

6. Add project dialogs at end of component (remove old project dialog):
```tsx
<CreateProjectDialog
  open={createProjectOpen}
  onOpenChange={setCreateProjectOpen}
  onCreated={handleProjectCreated}
/>
<ProjectSettingsDialog
  project={editingProject}
  open={!!editingProject}
  onOpenChange={(open) => !open && setEditingProject(null)}
  onUpdated={handleProjectUpdated}
/>
<DeleteProjectDialog
  project={deletingProject}
  open={!!deletingProject}
  onOpenChange={(open) => !open && setDeletingProject(null)}
  onDeleted={handleProjectDeleted}
/>
```

7. Remove old inline project dialog code (Dialog with newProjectName state).
  </action>
  <verify>
- + button opens CreateProjectDialog with color picker
- Right-click project -> Settings opens ProjectSettingsDialog
- Right-click project -> Delete opens DeleteProjectDialog with cascade warning
- All CRUD operations work and update UI
  </verify>
  <done>Project dialogs wired into App with context menu integration</done>
</task>

</tasks>

<verification>
1. Click + in sidebar -> CreateProjectDialog opens with name field + color picker
2. Create project -> closes dialog, project appears in sidebar
3. Right-click project -> context menu with Settings, Delete
4. Settings -> opens ProjectSettingsDialog with current name/color
5. Save settings -> updates blob color and name
6. Delete -> AlertDialog with cascade warning
7. Confirm delete -> project and tasks removed
</verification>

<success_criteria>
- Create project dialog has name + color picker (NAV-04)
- Project settings dialog edits name + color (NAV-05)
- Right-click context menu on project blobs (NAV-03)
- Delete confirmation warns about cascade
- All dialogs use shadcn components
</success_criteria>

<output>
After completion, create `.planning/phases/03-navigation/03-04-SUMMARY.md`
</output>
