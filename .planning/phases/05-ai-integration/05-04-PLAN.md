---
phase: 05-ai-integration
plan: 04
type: execute
wave: 4
depends_on: ["05-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can send message and see streaming response"
    - "User can cancel ongoing stream"
    - "Messages persist after page refresh"
  artifacts: []
  key_links: []
---

<objective>
Human verification of end-to-end AI chat functionality.

Purpose: Confirm streaming, cancellation, and persistence work correctly
Output: Verified working chat integration
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-ai-integration/05-03-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Claude CLI integration with streaming chat UI:
- Spawner service starts `claude -p --output-format stream-json`
- IPC layer forwards chunks to renderer via callbacks
- useClaude hook accumulates streaming content
- ChatPanel displays messages with auto-scroll
- ChatInput supports send (Enter) and cancel (Stop button)
- Messages persist to chat_messages table
  </what-built>
  <how-to-verify>
**Setup:**
1. Ensure Claude CLI is installed and authenticated (`claude --version`)
2. Start app: `npm run dev`

**Test 1: Basic Streaming**
1. Open task detail page (any task)
2. Need to temporarily add ChatPanel to test - in TaskDetailPage.tsx, add:
   ```typescript
   import { ChatPanel } from '@/components/chat'
   // In render, add below description:
   <ChatPanel task={task} />
   ```
3. Type "Say hello in exactly 3 words" and press Enter
4. Observe: Response should stream character-by-character
5. PASS if: Text appears incrementally, not all at once

**Test 2: Cancel Stream**
1. Send message "Write a long poem about coding"
2. While streaming, click the red Stop button
3. PASS if: Streaming stops immediately, partial response visible

**Test 3: Context Awareness**
1. Create task titled "Fix login bug" with description "Users getting 401 errors"
2. Open that task's detail page
3. Ask "What's my current task about?"
4. PASS if: Claude mentions login bug or 401 errors

**Test 4: Persistence (skip if no workspace_item wiring yet)**
- Note: Full persistence requires workspace_items which comes in Phase 6
- For now, confirm no errors when workspaceItemId is undefined
  </how-to-verify>
  <resume-signal>Type "verified" if all tests pass, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
- [ ] Basic streaming works
- [ ] Cancel stops response immediately
- [ ] Task context included in prompt
- [ ] No console errors during operation
</verification>

<success_criteria>
Phase 5 success criteria met:
1. User can send message in chat UI
2. Claude CLI spawns with task context
3. Response streams character-by-character
4. User can cancel ongoing response
5. (Persistence deferred to Phase 6 workspace integration)
</success_criteria>

<output>
After completion, create `.planning/phases/05-ai-integration/05-04-SUMMARY.md`
</output>
