---
phase: 02-data-layer
plan: 03
type: execute
wave: 3
depends_on: ["02-02"]
files_modified:
  - src/renderer/src/App.tsx
  - src/renderer/src/components/TaskList.tsx
  - src/renderer/src/components/TaskItem.tsx
  - src/renderer/src/components/CreateTaskDialog.tsx
  - src/renderer/src/components/EditTaskDialog.tsx
  - src/renderer/src/components/DeleteTaskDialog.tsx
  - src/renderer/src/components/ProjectSelect.tsx
autonomous: true

must_haves:
  truths:
    - "User can see list of tasks"
    - "User can create task with title, description, status, priority, due date"
    - "User can edit any task field"
    - "User can delete a task with confirmation"
    - "User can mark task as blocked with reason"
    - "User can create project with name and color"
  artifacts:
    - path: "src/renderer/src/components/TaskList.tsx"
      provides: "Task list with CRUD actions"
      contains: "TaskItem"
    - path: "src/renderer/src/components/CreateTaskDialog.tsx"
      provides: "Task creation form in dialog"
      contains: "DialogContent"
    - path: "src/renderer/src/components/EditTaskDialog.tsx"
      provides: "Task edit form in dialog"
      contains: "updateTask"
    - path: "src/renderer/src/components/DeleteTaskDialog.tsx"
      provides: "Delete confirmation"
      contains: "AlertDialogAction"
  key_links:
    - from: "src/renderer/src/components/TaskList.tsx"
      to: "window.api.db"
      via: "IPC calls for CRUD"
      pattern: "window\\.api\\.db\\.(getTasks|createTask)"
    - from: "src/renderer/src/components/CreateTaskDialog.tsx"
      to: "src/renderer/src/lib/schemas.ts"
      via: "Zod validation"
      pattern: "zodResolver.*createTaskSchema"
---

<objective>
Build CRUD UI for tasks with list view, create/edit dialogs, and delete confirmation.

Purpose: Fulfill Phase 2 success criteria for task CRUD.
Output: Working task list with create, edit, delete functionality.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-data-layer/02-RESEARCH.md
@.planning/phases/02-data-layer/02-01-SUMMARY.md
@.planning/phases/02-data-layer/02-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TaskList and TaskItem components</name>
  <files>
    - src/renderer/src/components/TaskList.tsx
    - src/renderer/src/components/TaskItem.tsx
  </files>
  <action>
    1. Create src/renderer/src/components/TaskItem.tsx:
       - Display: title, status badge, priority indicator, due date (if set), blocked indicator
       - Props: task, onEdit, onDelete
       - Status badge uses colored backgrounds (inbox=gray, todo=blue, in_progress=yellow, done=green)
       - Priority shows as P1-P5 text
       - Blocked shows red "Blocked" badge with reason tooltip
       - Overdue shows red text for past due dates
       - Edit button opens edit dialog
       - Delete button opens delete confirmation

       ```tsx
       interface TaskItemProps {
         task: Task
         onEdit: (task: Task) => void
         onDelete: (task: Task) => void
       }
       ```

       Use Tailwind for styling. Keep compact - single row per task.

    2. Create src/renderer/src/components/TaskList.tsx:
       - State: tasks array, loading boolean
       - useEffect loads tasks on mount via window.api.db.getTasks()
       - Maps over tasks rendering TaskItem for each
       - Passes onEdit and onDelete handlers
       - Shows "No tasks yet" when empty
       - Shows loading state initially

       Local state management:
       - After create: setTasks([...tasks, newTask])
       - After update: setTasks(tasks.map(t => t.id === updated.id ? updated : t))
       - After delete: setTasks(tasks.filter(t => t.id !== id))

       Include state for dialogs:
       - createDialogOpen: boolean
       - editingTask: Task | null
       - deletingTask: Task | null
  </action>
  <verify>
    npm run dev
    - TaskList renders (may be empty)
    - No console errors
    - Components import correctly
  </verify>
  <done>TaskList and TaskItem components render task data</done>
</task>

<task type="auto">
  <name>Task 2: Create task dialogs (Create, Edit, Delete)</name>
  <files>
    - src/renderer/src/components/CreateTaskDialog.tsx
    - src/renderer/src/components/EditTaskDialog.tsx
    - src/renderer/src/components/DeleteTaskDialog.tsx
    - src/renderer/src/components/ProjectSelect.tsx
  </files>
  <action>
    1. Create src/renderer/src/components/ProjectSelect.tsx:
       - Fetches projects on mount
       - Renders shadcn Select with project options
       - Props: value, onChange, disabled

    2. Create src/renderer/src/components/CreateTaskDialog.tsx:
       - shadcn Dialog with Form inside
       - Uses react-hook-form with zodResolver(createTaskSchema)
       - Fields: title (Input), description (Textarea), status (Select), priority (Select), dueDate (Calendar in Popover), projectId (ProjectSelect)
       - Props: open, onOpenChange, onCreated
       - On submit: calls window.api.db.createTask(), then onCreated(task)
       - Form reset after successful create
       - Title field auto-focused when dialog opens

       ```tsx
       interface CreateTaskDialogProps {
         open: boolean
         onOpenChange: (open: boolean) => void
         onCreated: (task: Task) => void
         defaultProjectId?: string
       }
       ```

    3. Create src/renderer/src/components/EditTaskDialog.tsx:
       - Similar to Create but pre-populates form with task data
       - Uses updateTaskSchema
       - Props: task (Task | null), open, onOpenChange, onUpdated
       - Additional field: blockedReason (Textarea, collapsed by default, expandable)
       - On submit: calls window.api.db.updateTask(), then onUpdated(task)
       - useEffect with form.reset() when task changes (pitfall #3 from research)

       ```tsx
       interface EditTaskDialogProps {
         task: Task | null
         open: boolean
         onOpenChange: (open: boolean) => void
         onUpdated: (task: Task) => void
       }
       ```

    4. Create src/renderer/src/components/DeleteTaskDialog.tsx:
       - shadcn AlertDialog
       - Props: task (Task | null), open, onOpenChange, onDeleted
       - Shows task title in confirmation message
       - On confirm: calls window.api.db.deleteTask(), then onDeleted()

       ```tsx
       interface DeleteTaskDialogProps {
         task: Task | null
         open: boolean
         onOpenChange: (open: boolean) => void
         onDeleted: () => void
       }
       ```
  </action>
  <verify>
    npm run dev
    - CreateTaskDialog opens and closes
    - Form fields render correctly
    - Validation shows errors for empty title
    - Calendar picker works for due date
  </verify>
  <done>All task dialogs functional with form validation</done>
</task>

<task type="auto">
  <name>Task 3: Wire up App.tsx with full CRUD flow</name>
  <files>
    - src/renderer/src/App.tsx
  </files>
  <action>
    Replace App.tsx with the main layout integrating all components:

    ```tsx
    import { useState, useEffect } from 'react'
    import type { Task, Project } from '../../shared/types/database'
    import { TaskList } from '@/components/TaskList'
    import { CreateTaskDialog } from '@/components/CreateTaskDialog'
    import { EditTaskDialog } from '@/components/EditTaskDialog'
    import { DeleteTaskDialog } from '@/components/DeleteTaskDialog'
    import { Button } from '@/components/ui/button'
    import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog'
    import { Input } from '@/components/ui/input'

    function App() {
      // Task state
      const [tasks, setTasks] = useState<Task[]>([])
      const [loading, setLoading] = useState(true)

      // Project state (for creating tasks)
      const [projects, setProjects] = useState<Project[]>([])
      const [selectedProjectId, setSelectedProjectId] = useState<string | null>(null)

      // Dialog state
      const [createOpen, setCreateOpen] = useState(false)
      const [editingTask, setEditingTask] = useState<Task | null>(null)
      const [deletingTask, setDeletingTask] = useState<Task | null>(null)

      // Quick project create
      const [newProjectName, setNewProjectName] = useState('')
      const [projectDialogOpen, setProjectDialogOpen] = useState(false)

      // Load data on mount
      useEffect(() => {
        Promise.all([
          window.api.db.getTasks(),
          window.api.db.getProjects()
        ]).then(([t, p]) => {
          setTasks(t)
          setProjects(p)
          if (p.length > 0 && !selectedProjectId) {
            setSelectedProjectId(p[0].id)
          }
          setLoading(false)
        })
      }, [])

      // CRUD handlers
      const handleTaskCreated = (task: Task) => {
        setTasks([task, ...tasks])
        setCreateOpen(false)
      }

      const handleTaskUpdated = (task: Task) => {
        setTasks(tasks.map(t => t.id === task.id ? task : t))
        setEditingTask(null)
      }

      const handleTaskDeleted = () => {
        if (deletingTask) {
          setTasks(tasks.filter(t => t.id !== deletingTask.id))
          setDeletingTask(null)
        }
      }

      const handleCreateProject = async () => {
        if (!newProjectName.trim()) return
        const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6']
        const color = colors[projects.length % colors.length]
        const project = await window.api.db.createProject({ name: newProjectName, color })
        setProjects([...projects, project])
        setSelectedProjectId(project.id)
        setNewProjectName('')
        setProjectDialogOpen(false)
      }

      if (loading) {
        return <div className="flex h-screen items-center justify-center">Loading...</div>
      }

      return (
        <div className="min-h-screen bg-background p-6">
          <header className="mb-6 flex items-center justify-between">
            <h1 className="text-2xl font-bold">Focus</h1>
            <div className="flex gap-2">
              <Dialog open={projectDialogOpen} onOpenChange={setProjectDialogOpen}>
                <DialogTrigger asChild>
                  <Button variant="outline">New Project</Button>
                </DialogTrigger>
                <DialogContent>
                  <DialogHeader>
                    <DialogTitle>Create Project</DialogTitle>
                  </DialogHeader>
                  <div className="flex gap-2">
                    <Input
                      value={newProjectName}
                      onChange={(e) => setNewProjectName(e.target.value)}
                      placeholder="Project name"
                      onKeyDown={(e) => e.key === 'Enter' && handleCreateProject()}
                    />
                    <Button onClick={handleCreateProject}>Create</Button>
                  </div>
                </DialogContent>
              </Dialog>
              <Button onClick={() => setCreateOpen(true)} disabled={projects.length === 0}>
                New Task
              </Button>
            </div>
          </header>

          {projects.length === 0 ? (
            <div className="text-center text-muted-foreground">
              Create a project to get started
            </div>
          ) : (
            <>
              {/* Project tabs */}
              <div className="mb-4 flex gap-2 border-b pb-2">
                {projects.map(p => (
                  <button
                    key={p.id}
                    onClick={() => setSelectedProjectId(p.id)}
                    className={`flex items-center gap-2 rounded px-3 py-1 ${
                      selectedProjectId === p.id ? 'bg-muted' : 'hover:bg-muted/50'
                    }`}
                  >
                    <span
                      className="h-2 w-2 rounded-full"
                      style={{ backgroundColor: p.color }}
                    />
                    {p.name}
                  </button>
                ))}
              </div>

              {/* Task list */}
              <TaskList
                tasks={tasks.filter(t => t.project_id === selectedProjectId)}
                onEdit={setEditingTask}
                onDelete={setDeletingTask}
              />
            </>
          )}

          {/* Dialogs */}
          <CreateTaskDialog
            open={createOpen}
            onOpenChange={setCreateOpen}
            onCreated={handleTaskCreated}
            defaultProjectId={selectedProjectId ?? undefined}
          />
          <EditTaskDialog
            task={editingTask}
            open={!!editingTask}
            onOpenChange={(open) => !open && setEditingTask(null)}
            onUpdated={handleTaskUpdated}
          />
          <DeleteTaskDialog
            task={deletingTask}
            open={!!deletingTask}
            onOpenChange={(open) => !open && setDeletingTask(null)}
            onDeleted={handleTaskDeleted}
          />
        </div>
      )
    }

    export default App
    ```

    This provides:
    - Project tabs for filtering
    - New Task / New Project buttons
    - Task list with edit/delete actions
    - All dialogs wired up
  </action>
  <verify>
    npm run dev
    Full CRUD flow:
    1. Create a project via "New Project" button
    2. Create a task via "New Task" button
    3. See task in list
    4. Click edit - modify title, status, priority, blocked reason
    5. Click delete - confirm - task removed
    6. Refresh app - data persists
  </verify>
  <done>Full CRUD flow working: create/view/edit/delete tasks and projects</done>
</task>

</tasks>

<verification>
Phase 2 success criteria verification:
1. User can create a task with title, description, status, priority, due date - YES (CreateTaskDialog)
2. User can edit any task field inline - YES (EditTaskDialog with all fields)
3. User can delete a task - YES (DeleteTaskDialog with confirmation)
4. User can mark a task as blocked with a reason - YES (blockedReason field in edit)
5. User can create a project with name and color - YES (quick project dialog)

Data persistence:
- Refresh app after CRUD operations
- Data should persist (SQLite storage)
</verification>

<success_criteria>
Requirements fulfilled:
- CORE-02: Task CRUD (create, read, update, delete)
- CORE-03: Status workflow (all 6 statuses selectable)
- CORE-04: Projects with name and color
- CORE-05: Blocked tasks with reason field
</success_criteria>

<output>
After completion, create `.planning/phases/02-data-layer/02-03-SUMMARY.md`
</output>
