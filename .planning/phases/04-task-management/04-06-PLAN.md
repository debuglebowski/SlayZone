---
phase: 04-task-management
plan: 06
type: execute
wave: 4
depends_on: ["04-05"]
files_modified:
  - src/renderer/src/components/task-detail/SubtaskAccordion.tsx
  - src/renderer/src/components/task-detail/SubtaskItem.tsx
  - src/renderer/src/components/task-detail/TaskDetailPage.tsx
autonomous: true

must_haves:
  truths:
    - "Subtasks accordion shows on task detail page"
    - "User can add a subtask"
    - "User can edit subtask title"
    - "User can change subtask status independently"
    - "User can delete a subtask"
    - "Subtasks count shown in accordion header"
  artifacts:
    - path: "src/renderer/src/components/task-detail/SubtaskAccordion.tsx"
      provides: "Collapsible subtask list"
      min_lines: 40
    - path: "src/renderer/src/components/task-detail/SubtaskItem.tsx"
      provides: "Individual subtask row"
      min_lines: 30
  key_links:
    - from: "src/renderer/src/components/task-detail/SubtaskAccordion.tsx"
      to: "window.api.db"
      via: "getSubtasks, createTask"
      pattern: "api\\.db\\.(getSubtasks|createTask)"
    - from: "src/renderer/src/components/task-detail/TaskDetailPage.tsx"
      to: "SubtaskAccordion"
      via: "component usage"
      pattern: "<SubtaskAccordion"
---

<objective>
Add subtasks feature to task detail page

Purpose: Enable breaking down tasks into smaller actionable items with independent status
Output: Subtask accordion on detail page with add/edit/delete/status change capability
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-task-management/04-RESEARCH.md
@.planning/phases/04-task-management/04-05-SUMMARY.md
@src/renderer/src/components/task-detail/TaskDetailPage.tsx
@src/shared/types/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SubtaskItem component</name>
  <files>src/renderer/src/components/task-detail/SubtaskItem.tsx</files>
  <action>
    Individual subtask row component:

    Props:
    - subtask: Task
    - onUpdate: (subtask: Task) => void
    - onDelete: (subtaskId: string) => void

    Layout (horizontal row):
    - Status checkbox/toggle (simplified: done vs not done)
    - Title (click to edit inline, blur to save)
    - Delete button (X icon, confirm or immediate)

    Status handling:
    - Click checkbox toggles between 'done' and 'todo'
    - Call API to update, then onUpdate with result

    Title editing:
    - Click enters edit mode (input replaces text)
    - Blur or Enter saves
    - Escape cancels

    Styling:
    - Strikethrough + muted text when done
    - Compact padding (py-2)
    - Delete button shows on hover
  </action>
  <verify>Component renders and handles status toggle</verify>
  <done>SubtaskItem shows title, toggles status, allows delete</done>
</task>

<task type="auto">
  <name>Task 2: Create SubtaskAccordion component</name>
  <files>src/renderer/src/components/task-detail/SubtaskAccordion.tsx</files>
  <action>
    Collapsible subtask container:

    Props:
    - parentTaskId: string
    - projectId: string (needed to create subtask)

    State:
    - subtasks: Task[]
    - expanded: boolean (default true if subtasks exist)
    - newTitle: string (for add input)

    Load on mount:
    - window.api.db.getSubtasks(parentTaskId)
    - Update state with result

    Layout:
    - Use shadcn Collapsible
    - Trigger: "Subtasks (N)" with chevron icon
    - Content: list of SubtaskItem, then Add input

    Add subtask:
    - Input with placeholder "Add subtask..."
    - Enter creates subtask via API: createTask({ projectId, parentId: parentTaskId, title: newTitle })
    - Clear input and prepend to list

    Handlers:
    - handleSubtaskUpdate: update subtask in local array
    - handleSubtaskDelete: remove from array, call API
    - handleAddSubtask: create via API, add to array

    Consider: keep subtasks in local state, or refetch after each change
  </action>
  <verify>Accordion expands/collapses, shows count</verify>
  <done>SubtaskAccordion manages subtask list with add/edit/delete</done>
</task>

<task type="auto">
  <name>Task 3: Integrate SubtaskAccordion into TaskDetailPage</name>
  <files>src/renderer/src/components/task-detail/TaskDetailPage.tsx</files>
  <action>
    Add SubtaskAccordion to detail page layout:

    Position after description:
    - Border-top separator
    - SubtaskAccordion with parentTaskId={task.id} projectId={task.project_id}

    No additional state needed in TaskDetailPage - SubtaskAccordion manages its own.

    Optional: Add summary to metadata row
    - Could show "3 subtasks (1 done)" inline
    - Or leave that for future enhancement
  </action>
  <verify>Task detail shows subtask section, can add and manage subtasks</verify>
  <done>Subtasks fully functional in task detail page</done>
</task>

</tasks>

<verification>
- Subtask accordion appears on task detail page
- Accordion shows count: "Subtasks (3)"
- Expand shows list of subtasks
- Can add subtask with Enter key
- Can toggle subtask status (checkbox)
- Can edit subtask title inline
- Can delete subtask
- Subtasks don't appear in main kanban (parent_id filter)
</verification>

<success_criteria>
- Subtasks CRUD fully working
- Status independent from parent task
- Clean UX with accordion pattern
</success_criteria>

<output>
After completion, create `.planning/phases/04-task-management/04-06-SUMMARY.md`
</output>
