---
phase: 04-task-management
plan: 05
type: execute
wave: 3
depends_on: ["04-02"]
files_modified:
  - src/renderer/src/components/task-detail/TaskDetailPage.tsx
  - src/renderer/src/components/task-detail/TaskMetadataRow.tsx
  - src/renderer/src/components/task-detail/MarkdownEditor.tsx
  - src/renderer/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Clicking task card opens full task detail page"
    - "Task detail page shows all fields"
    - "User can edit title inline"
    - "User can edit metadata (status, priority, due date, tags) inline"
    - "Markdown description renders, click to edit"
    - "Back button returns to kanban view"
  artifacts:
    - path: "src/renderer/src/components/task-detail/TaskDetailPage.tsx"
      provides: "Full task detail view"
      min_lines: 80
    - path: "src/renderer/src/components/task-detail/MarkdownEditor.tsx"
      provides: "Click-to-edit markdown component"
      min_lines: 40
    - path: "src/renderer/src/components/task-detail/TaskMetadataRow.tsx"
      provides: "Inline editable metadata fields"
      min_lines: 50
  key_links:
    - from: "src/renderer/src/components/task-detail/MarkdownEditor.tsx"
      to: "react-markdown"
      via: "import"
      pattern: "import.*ReactMarkdown"
    - from: "src/renderer/src/App.tsx"
      to: "TaskDetailPage"
      via: "conditional render"
      pattern: "view\\.type.*task-detail"
---

<objective>
Build task detail page with inline editing and markdown description

Purpose: Full task view for editing all fields, replacing modal-based editing for detailed work
Output: Task detail page accessible from kanban, with click-to-edit fields and markdown support
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-task-management/04-RESEARCH.md
@.planning/phases/04-task-management/04-02-SUMMARY.md
@src/renderer/src/App.tsx
@src/shared/types/database.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MarkdownEditor component</name>
  <files>src/renderer/src/components/task-detail/MarkdownEditor.tsx</files>
  <action>
    Create click-to-edit markdown component:

    Props:
    - value: string
    - onChange: (value: string) => void
    - onSave: () => Promise<void>
    - placeholder?: string

    State:
    - editing: boolean
    - textareaRef for focus management

    Render mode (editing = false):
    - Clickable div with prose styling
    - ReactMarkdown with remarkGfm plugin
    - If empty, show placeholder text in muted color
    - onClick sets editing = true

    Edit mode (editing = true):
    - Textarea with value/onChange
    - onBlur calls onSave then sets editing = false
    - Escape key cancels (sets editing = false without save)
    - Cmd/Ctrl+Enter saves and exits
    - Auto-focus textarea on mount
    - Move cursor to end on focus

    Styling:
    - min-h-[100px] for render div
    - min-h-[200px] for textarea
    - font-mono for textarea
    - prose prose-sm dark:prose-invert for rendered markdown
  </action>
  <verify>Component renders markdown and switches to edit mode on click</verify>
  <done>MarkdownEditor toggles between render and edit, saves on blur</done>
</task>

<task type="auto">
  <name>Task 2: Create TaskMetadataRow and TaskDetailPage</name>
  <files>
    src/renderer/src/components/task-detail/TaskMetadataRow.tsx
    src/renderer/src/components/task-detail/TaskDetailPage.tsx
  </files>
  <action>
    TaskMetadataRow.tsx:
    - Props: task: Task, tags: Tag[], taskTagIds: string[], onUpdate: (task: Task) => void, onTagsChange: (tagIds: string[]) => void
    - Horizontal row with inline-editable fields:
      - Status: Select dropdown (shadcn Select)
      - Priority: Select P1-P5
      - Due date: Date picker (shadcn Calendar in Popover)
      - Tags: Popover with checkboxes
      - Blocked: Toggle/input for blocked_reason
    - Each change calls API immediately and onUpdate with result
    - Compact styling with labels

    TaskDetailPage.tsx:
    - Props: taskId: string, onBack: () => void, onTaskUpdated: (task: Task) => void
    - Load task on mount: window.api.db.getTask(taskId)
    - Load task's tags: window.api.taskTags.getTagsForTask(taskId)
    - Load all tags for selector: window.api.tags.getTags()

    Layout:
    - Header bar with back button (ArrowLeft icon) and inline-editable title
    - TaskMetadataRow below header
    - MarkdownEditor for description (full width)
    - Placeholder for subtasks section (will add in next plan)

    Inline title editing:
    - Click title to edit (contentEditable or input toggle)
    - Blur saves to API

    State management:
    - Local task state, update on API responses
    - Call onTaskUpdated to sync parent state
  </action>
  <verify>Task detail page loads task and allows editing</verify>
  <done>TaskDetailPage renders with all editable fields</done>
</task>

<task type="auto">
  <name>Task 3: Add state-based navigation to App.tsx</name>
  <files>src/renderer/src/App.tsx</files>
  <action>
    Add view state type:
    ```typescript
    type ViewState =
      | { type: 'kanban' }
      | { type: 'task-detail'; taskId: string }
    ```

    Replace editingTask pattern with view state:
    - const [view, setView] = useState<ViewState>({ type: 'kanban' })

    Navigation handlers:
    - openTaskDetail = (taskId: string) => setView({ type: 'task-detail', taskId })
    - closeTaskDetail = () => setView({ type: 'kanban' })

    Update KanbanBoard onTaskClick:
    - Change from setEditingTask to openTaskDetail

    Conditional rendering:
    - If view.type === 'task-detail', render TaskDetailPage (without sidebar)
    - Else render existing SidebarProvider + kanban layout

    Sync task updates:
    - TaskDetailPage.onTaskUpdated should update tasks state in App
    - handleTaskUpdated = (task) => setTasks(tasks.map(t => t.id === task.id ? task : t))
  </action>
  <verify>Click card -> detail page, back button -> kanban</verify>
  <done>Navigation between kanban and task detail works</done>
</task>

</tasks>

<verification>
- Click task card opens detail page
- Detail page shows task title, all metadata, description
- Click title to edit inline
- Status/priority/due date selectors work
- Tags can be added/removed
- Markdown description renders with GFM support
- Click description to edit, blur to save
- Back button returns to kanban
- Changes persist after navigation
</verification>

<success_criteria>
- Task detail page fully functional
- All fields editable inline
- Markdown renders and edits correctly
- Navigation state-based (no router)
</success_criteria>

<output>
After completion, create `.planning/phases/04-task-management/04-05-SUMMARY.md`
</output>
