---
phase: 04-task-management
plan: 03
type: execute
wave: 3
depends_on: ["04-01", "04-02"]
files_modified:
  - src/renderer/src/components/filters/FilterState.ts
  - src/renderer/src/components/filters/FilterBar.tsx
  - src/renderer/src/components/filters/GroupBySelect.tsx
  - src/renderer/src/hooks/useFilterState.ts
autonomous: true

must_haves:
  truths:
    - "User can select group by mode (status, priority, due date)"
    - "User can filter by priority level"
    - "User can filter by due date range"
    - "User can toggle blocked/done visibility"
    - "Filter state persists per project"
  artifacts:
    - path: "src/renderer/src/components/filters/FilterState.ts"
      provides: "FilterState type and defaults"
      exports: ["FilterState", "defaultFilterState"]
    - path: "src/renderer/src/components/filters/FilterBar.tsx"
      provides: "Filter controls UI"
      min_lines: 50
    - path: "src/renderer/src/hooks/useFilterState.ts"
      provides: "Filter persistence hook"
      exports: ["useFilterState"]
  key_links:
    - from: "src/renderer/src/hooks/useFilterState.ts"
      to: "window.api.settings"
      via: "SQLite persistence"
      pattern: "settings\\.(get|set)"
---

<objective>
Build filter controls and persistence for kanban grouping/filtering

Purpose: Allow users to organize and filter their task view by various criteria
Output: Filter bar component with group by selector and filter toggles, state persisted per project
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-task-management/04-RESEARCH.md
@.planning/phases/04-task-management/04-02-SUMMARY.md
@src/shared/types/api.ts
@src/renderer/src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create filter types and persistence hook</name>
  <files>
    src/renderer/src/components/filters/FilterState.ts
    src/renderer/src/hooks/useFilterState.ts
  </files>
  <action>
    FilterState.ts - define filter state shape:
    ```typescript
    export type GroupKey = 'status' | 'priority' | 'due_date'
    export type DueDateRange = 'all' | 'overdue' | 'today' | 'week' | 'later'

    export interface FilterState {
      groupBy: GroupKey
      priority: number | null      // null = all priorities
      dueDateRange: DueDateRange
      tagIds: string[]             // selected tag IDs
      showBlocked: boolean
      showDone: boolean
    }

    export const defaultFilterState: FilterState = {
      groupBy: 'status',
      priority: null,
      dueDateRange: 'all',
      tagIds: [],
      showBlocked: true,
      showDone: true
    }
    ```

    useFilterState.ts - persist to SQLite settings:
    - Takes projectId: string | null (null for All view)
    - Stores as JSON at key filter:${projectId} or filter:all
    - Returns [filterState, setFilterState, isLoaded]
    - Load on mount and when projectId changes
    - Debounced save (500ms) when filter changes
    - Return isLoaded to prevent flash of wrong state
  </action>
  <verify>npx tsc --noEmit passes</verify>
  <done>FilterState type exported, useFilterState hook returns persisted state</done>
</task>

<task type="auto">
  <name>Task 2: Build filter bar components</name>
  <files>
    src/renderer/src/components/filters/GroupBySelect.tsx
    src/renderer/src/components/filters/FilterBar.tsx
  </files>
  <action>
    GroupBySelect.tsx:
    - Props: value: GroupKey, onChange: (v: GroupKey) => void
    - Use shadcn Select component
    - Options: Status (status), Priority (priority), Due Date (due_date)

    FilterBar.tsx:
    - Props: filter: FilterState, onChange: (f: FilterState) => void, tags: Tag[]
    - Layout: horizontal bar with gap-4
    - Include GroupBySelect
    - Priority filter: Select with All, P1, P2, P3, P4, P5
    - Due date filter: Select with All, Overdue, Today, This Week, Later
    - Tags filter: Popover with checkbox list (multi-select)
    - Toggle switches: Show Blocked, Show Done (use shadcn Switch or Button toggle)

    Style as compact toolbar that fits above kanban board.
  </action>
  <verify>Components render without error in isolation</verify>
  <done>FilterBar renders all filter controls</done>
</task>

<task type="auto">
  <name>Task 3: Create filter logic utility</name>
  <files>src/renderer/src/lib/kanban.ts</files>
  <action>
    Add to existing kanban.ts (created in Plan 02):

    Export applyFilters(tasks: Task[], filter: FilterState, taskTags: Map<string, string[]>): Task[]
    - If priority !== null, filter to tasks with matching priority
    - If dueDateRange !== 'all', filter by date bucket:
      - 'overdue': due_date < today
      - 'today': due_date === today
      - 'week': due_date > today && due_date <= today+7
      - 'later': due_date > today+7
    - If tagIds.length > 0, filter to tasks that have at least one matching tag
    - If !showBlocked, filter out tasks with blocked_reason
    - If !showDone, filter out tasks with status === 'done'

    Note: taskTags is Map<taskId, tagId[]> - will be populated from API in App.tsx
  </action>
  <verify>npx tsc --noEmit passes</verify>
  <done>applyFilters function filters tasks by all criteria</done>
</task>

</tasks>

<verification>
- FilterState type defines all filter options
- useFilterState persists to SQLite and loads on project change
- FilterBar renders group by selector and filter controls
- applyFilters correctly filters task array
</verification>

<success_criteria>
- Filter state types defined and exported
- useFilterState hook persists filter per project
- FilterBar component renders all controls
- Filter logic ready for integration
</success_criteria>

<output>
After completion, create `.planning/phases/04-task-management/04-03-SUMMARY.md`
</output>
