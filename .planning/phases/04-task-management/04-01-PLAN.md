---
phase: 04-task-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/shared/types/api.ts
  - src/main/ipc/database.ts
  - src/preload/index.ts
autonomous: true

must_haves:
  truths:
    - "dnd-kit and react-markdown packages installed"
    - "Tasks can be created with parentId for subtasks"
    - "Task tags can be assigned and retrieved"
  artifacts:
    - path: "package.json"
      provides: "@dnd-kit/core, @dnd-kit/sortable, @dnd-kit/utilities, react-markdown, remark-gfm"
      contains: "@dnd-kit/core"
    - path: "src/shared/types/api.ts"
      provides: "parentId in CreateTaskInput, task_tags API types"
      exports: ["CreateTaskInput", "ElectronAPI"]
    - path: "src/main/ipc/database.ts"
      provides: "IPC handlers for subtasks and task_tags"
      contains: "db:taskTags"
  key_links:
    - from: "src/preload/index.ts"
      to: "src/main/ipc/database.ts"
      via: "IPC channel registration"
      pattern: "taskTags"
---

<objective>
Install dnd-kit + react-markdown, extend API for subtasks and task_tags

Purpose: Foundation libraries and API extensions needed for kanban, markdown editing, and task organization features
Output: Installed packages, extended types, working IPC handlers for subtasks and tag assignment
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-task-management/04-RESEARCH.md
@src/shared/types/api.ts
@src/main/ipc/database.ts
@src/preload/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dnd-kit and markdown packages</name>
  <files>package.json</files>
  <action>
    Run: npm install @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities react-markdown remark-gfm

    These are actively maintained packages with TypeScript support:
    - @dnd-kit for kanban drag-drop (replaces deprecated react-beautiful-dnd)
    - react-markdown for safe markdown rendering (no dangerouslySetInnerHTML)
    - remark-gfm for GitHub Flavored Markdown (tables, strikethrough)
  </action>
  <verify>npm ls @dnd-kit/core react-markdown shows both installed</verify>
  <done>Packages in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Extend API types for subtasks and task_tags</name>
  <files>src/shared/types/api.ts</files>
  <action>
    In CreateTaskInput, add optional parentId field:
    - parentId?: string (for creating subtasks)

    Add new interfaces for task_tags junction:
    - interface TaskTagInput { taskId: string; tagId: string }

    Extend ElectronAPI.db with:
    - getSubtasks: (parentId: string) => Promise<Task[]>

    Add new namespace ElectronAPI.taskTags with:
    - getTagsForTask: (taskId: string) => Promise<Tag[]>
    - setTagsForTask: (taskId: string, tagIds: string[]) => Promise<void>

    Keep existing types unchanged. Only add new fields/methods.
  </action>
  <verify>TypeScript compiles: npx tsc --noEmit</verify>
  <done>CreateTaskInput has parentId, ElectronAPI has taskTags namespace</done>
</task>

<task type="auto">
  <name>Task 3: Add IPC handlers for subtasks and task_tags</name>
  <files>src/main/ipc/database.ts, src/preload/index.ts</files>
  <action>
    In database.ts, add parentId to tasks:create INSERT:
    - Add parent_id to INSERT columns
    - Pass data.parentId ?? null as value

    Add new handler db:tasks:getSubtasks:
    - Query: SELECT * FROM tasks WHERE parent_id = ? ORDER BY created_at

    Add new handlers for task_tags junction:
    - db:taskTags:getForTask: SELECT tags.* FROM tags JOIN task_tags ON tags.id = task_tags.tag_id WHERE task_tags.task_id = ?
    - db:taskTags:setForTask: Delete existing, insert new (transaction)
      - DELETE FROM task_tags WHERE task_id = ?
      - INSERT INTO task_tags (task_id, tag_id) VALUES (?, ?) for each tagId

    In preload/index.ts, expose new IPC methods:
    - db.getSubtasks
    - taskTags.getTagsForTask
    - taskTags.setTagsForTask
  </action>
  <verify>App runs: npm run dev, no console errors</verify>
  <done>IPC handlers respond, preload exposes methods</done>
</task>

</tasks>

<verification>
- npm ls shows @dnd-kit/core, react-markdown, remark-gfm installed
- npx tsc --noEmit passes
- npm run dev starts without errors
- window.api.taskTags exists in renderer console
</verification>

<success_criteria>
- All packages installed in dependencies
- TypeScript compiles with new API types
- App starts and IPC handlers registered
</success_criteria>

<output>
After completion, create `.planning/phases/04-task-management/04-01-SUMMARY.md`
</output>
