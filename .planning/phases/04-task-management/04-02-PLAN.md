---
phase: 04-task-management
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/renderer/src/components/kanban/KanbanBoard.tsx
  - src/renderer/src/components/kanban/KanbanColumn.tsx
  - src/renderer/src/components/kanban/KanbanCard.tsx
  - src/renderer/src/lib/kanban.ts
  - src/renderer/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Kanban board renders tasks in columns grouped by status"
    - "User can drag task from one column to another"
    - "Task status updates when dropped in new column"
    - "Only root tasks shown (not subtasks)"
  artifacts:
    - path: "src/renderer/src/components/kanban/KanbanBoard.tsx"
      provides: "DndContext with columns"
      min_lines: 60
    - path: "src/renderer/src/components/kanban/KanbanColumn.tsx"
      provides: "Droppable column container"
      min_lines: 30
    - path: "src/renderer/src/components/kanban/KanbanCard.tsx"
      provides: "Draggable task card"
      min_lines: 40
    - path: "src/renderer/src/lib/kanban.ts"
      provides: "groupTasksBy function"
      exports: ["groupTasksBy"]
  key_links:
    - from: "src/renderer/src/components/kanban/KanbanBoard.tsx"
      to: "src/renderer/src/lib/kanban.ts"
      via: "groupTasksBy import"
      pattern: "import.*groupTasksBy"
    - from: "src/renderer/src/components/kanban/KanbanBoard.tsx"
      to: "@dnd-kit/core"
      via: "DndContext usage"
      pattern: "DndContext"
    - from: "src/renderer/src/App.tsx"
      to: "KanbanBoard"
      via: "component render"
      pattern: "<KanbanBoard"
---

<objective>
Build kanban board with drag-drop between status columns

Purpose: Core visual for task management - replace flat list with grouped columns
Output: Working kanban board where dragging task between columns updates status
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-task-management/04-RESEARCH.md
@.planning/phases/04-task-management/04-01-SUMMARY.md
@src/renderer/src/App.tsx
@src/shared/types/database.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create grouping utility and types</name>
  <files>src/renderer/src/lib/kanban.ts</files>
  <action>
    Create kanban utility module:

    Define types:
    - GroupKey = 'status' | 'priority' | 'due_date'
    - Column = { id: string; title: string; tasks: Task[] }

    Define constants:
    - STATUS_ORDER: TaskStatus[] = ['inbox', 'backlog', 'todo', 'in_progress', 'review', 'done']
    - STATUS_LABELS: Record<TaskStatus, string> for display names

    Implement groupTasksBy(tasks: Task[], groupBy: GroupKey): Column[]
    - Filter out subtasks first: tasks.filter(t => t.parent_id === null)
    - For 'status': map STATUS_ORDER to columns with filtered tasks
    - For 'priority': columns P1-P5
    - For 'due_date': Overdue, Today, This Week, Later, No Date

    Helper: todayISO() returns YYYY-MM-DD string for today
    Helper: addDaysISO(date: string, days: number) for week calculation
  </action>
  <verify>Import works: add temporary import in App.tsx, tsc --noEmit</verify>
  <done>groupTasksBy function exported, handles all three group modes</done>
</task>

<task type="auto">
  <name>Task 2: Build kanban components</name>
  <files>
    src/renderer/src/components/kanban/KanbanBoard.tsx
    src/renderer/src/components/kanban/KanbanColumn.tsx
    src/renderer/src/components/kanban/KanbanCard.tsx
  </files>
  <action>
    KanbanCard.tsx (presentational):
    - Props: task: Task, isDragging?: boolean, onClick?: () => void
    - Render: Card with title, overdue indicator if due_date < today, blocked indicator
    - Styling: cursor-grab, shadow on drag, line-clamp-2 for title
    - Show project color dot placeholder (will wire in All view later)

    KanbanColumn.tsx:
    - Props: column: Column, onTaskClick?: (task: Task) => void
    - Use useDroppable from @dnd-kit/core with id = column.id
    - Use SortableContext for tasks
    - Render header with column.title and count
    - Map tasks to SortableKanbanCard wrapper
    - SortableKanbanCard uses useSortable, renders KanbanCard

    KanbanBoard.tsx:
    - Props: tasks: Task[], groupBy: GroupKey, onTaskMove, onTaskClick
    - useSensors with PointerSensor (distance: 5) and KeyboardSensor
    - useState for activeId (dragging task)
    - DndContext with sensors, closestCorners collision
    - onDragStart: setActiveId
    - onDragEnd: extract active.id (taskId) and over.id (columnId), call onTaskMove
    - Render columns in flex row with overflow-x-auto
    - DragOverlay with KanbanCard for active task (presentational only!)
  </action>
  <verify>Components import without error: npx tsc --noEmit</verify>
  <done>Three kanban components created with dnd-kit integration</done>
</task>

<task type="auto">
  <name>Task 3: Wire kanban board to App.tsx</name>
  <files>src/renderer/src/App.tsx</files>
  <action>
    Replace TaskList with KanbanBoard:

    Add state:
    - groupBy: GroupKey = 'status' (default)

    Add handler:
    - handleTaskMove(taskId: string, newColumnId: string):
      - For status grouping: updateTask({ id: taskId, status: newColumnId as TaskStatus })
      - Update local tasks state with returned task

    Replace TaskList usage with:
    <KanbanBoard
      tasks={filteredTasks}
      groupBy={groupBy}
      onTaskMove={handleTaskMove}
      onTaskClick={(task) => setEditingTask(task)}
    />

    Keep EditTaskDialog for now (click opens edit dialog).
    Task detail page comes in later plan.
  </action>
  <verify>npm run dev shows kanban board, can drag tasks between columns</verify>
  <done>Kanban renders with status columns, drag updates task status</done>
</task>

</tasks>

<verification>
- App shows kanban columns (Inbox, Backlog, Todo, In Progress, Review, Done)
- Tasks appear in correct column based on status
- Dragging task to different column updates status
- Subtasks don't appear in kanban (only root tasks)
- Status persists after refresh
</verification>

<success_criteria>
- Kanban board displays with 6 status columns
- Drag-drop changes task status in database
- UI updates immediately on drop
</success_criteria>

<output>
After completion, create `.planning/phases/04-task-management/04-02-SUMMARY.md`
</output>
