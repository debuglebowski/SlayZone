---
phase: 04-task-management
plan: 04
type: execute
wave: 3
depends_on: ["04-02", "04-03"]
files_modified:
  - src/renderer/src/App.tsx
  - src/renderer/src/components/kanban/KanbanCard.tsx
autonomous: true

must_haves:
  truths:
    - "Filter bar appears above kanban board"
    - "Changing group by mode re-groups tasks"
    - "Filter controls filter displayed tasks"
    - "Filter state persists when switching projects"
    - "Task cards show project color dot in All view"
    - "Task cards show overdue indicator"
  artifacts:
    - path: "src/renderer/src/App.tsx"
      provides: "Integrated filter bar and kanban"
      contains: "useFilterState"
  key_links:
    - from: "src/renderer/src/App.tsx"
      to: "src/renderer/src/components/filters/FilterBar.tsx"
      via: "component usage"
      pattern: "<FilterBar"
    - from: "src/renderer/src/App.tsx"
      to: "src/renderer/src/lib/kanban.ts"
      via: "applyFilters usage"
      pattern: "applyFilters"
---

<objective>
Integrate filter bar with kanban board and add card indicators

Purpose: Connect filter controls to kanban display, add visual indicators to task cards
Output: Working filter/grouping system with project colors and overdue badges
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-task-management/04-02-SUMMARY.md
@.planning/phases/04-task-management/04-03-SUMMARY.md
@src/renderer/src/App.tsx
@src/renderer/src/components/kanban/KanbanCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate filters into App.tsx</name>
  <files>src/renderer/src/App.tsx</files>
  <action>
    Import and use useFilterState hook:
    - const [filter, setFilter, filterLoaded] = useFilterState(selectedProjectId)

    Load tags on mount (add to initial Promise.all):
    - const [tags, setTags] = useState<Tag[]>([])
    - window.api.tags.getTags()

    Load task tags mapping:
    - const [taskTags, setTaskTags] = useState<Map<string, string[]>>(new Map())
    - Create helper to load: iterate tasks, call window.api.taskTags.getTagsForTask
    - Or: batch load after tasks load

    Apply filters to tasks:
    - const displayTasks = applyFilters(filteredTasks, filter, taskTags)
    - Pass displayTasks to KanbanBoard

    Add FilterBar above KanbanBoard:
    - Show loading skeleton until filterLoaded
    - <FilterBar filter={filter} onChange={setFilter} tags={tags} />

    Pass groupBy from filter to KanbanBoard:
    - <KanbanBoard groupBy={filter.groupBy} ... />

    Update handleTaskMove to handle different groupBy modes:
    - 'status': update status field
    - 'priority': update priority field (parse column id like 'p1' -> 1)
    - 'due_date': handle specially (maybe show toast "can't drag to date columns")
  </action>
  <verify>npm run dev shows filter bar above kanban</verify>
  <done>Filter bar controls kanban grouping and filtering</done>
</task>

<task type="auto">
  <name>Task 2: Enhance KanbanCard with indicators</name>
  <files>src/renderer/src/components/kanban/KanbanCard.tsx</files>
  <action>
    Add props:
    - project?: Project (optional, passed when in All view)
    - showProject?: boolean

    Show project color dot:
    - If showProject && project, render small colored dot before title
    - Use project.color for background
    - Size: w-2 h-2 rounded-full

    Show overdue indicator:
    - Compare task.due_date to today (todayISO helper)
    - If due_date exists and due_date < today and status !== 'done':
      - Show red "Overdue" badge or red text
      - Use text-destructive class

    Show blocked indicator:
    - If task.blocked_reason exists, show subtle blocked indicator
    - Could be icon or "Blocked" text in muted color
    - Optionally reduce card opacity (opacity-60)

    Keep card compact - use small text (text-xs) for indicators
  </action>
  <verify>Cards show colored dot in All view, red text for overdue</verify>
  <done>Task cards display project color, overdue, and blocked indicators</done>
</task>

<task type="auto">
  <name>Task 3: Wire project colors to kanban</name>
  <files>src/renderer/src/App.tsx</files>
  <action>
    Pass projects to KanbanBoard:
    - Add projects prop to KanbanBoard component type
    - <KanbanBoard projects={projects} ... />

    In KanbanBoard, pass to KanbanColumn, then to KanbanCard:
    - Lookup project for each task: projects.find(p => p.id === task.project_id)
    - Pass project prop when in All view (selectedProjectId === null)
    - Pass showProject={selectedProjectId === null}

    Alternative simpler approach:
    - Create projectsMap in App.tsx: new Map(projects.map(p => [p.id, p]))
    - Pass projectsMap to KanbanBoard
    - Lookup in KanbanCard: projectsMap.get(task.project_id)
  </action>
  <verify>In All view, each card shows colored dot matching project</verify>
  <done>Project color dots visible in All view</done>
</task>

</tasks>

<verification>
- Filter bar renders above kanban with all controls
- Changing group by switches between status/priority/due columns
- Filter by priority shows only matching priority tasks
- Filter by due date range works correctly
- Show blocked toggle hides/shows blocked tasks
- Show done toggle hides/shows done tasks
- Project color dots appear in All view
- Overdue badge appears on past-due tasks
- Filter state persists when switching projects
</verification>

<success_criteria>
- All filter controls functional
- Visual indicators on task cards
- Filter persistence working
</success_criteria>

<output>
After completion, create `.planning/phases/04-task-management/04-04-SUMMARY.md`
</output>
