---
phase: 09-search
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/src/components/ui/command.tsx
  - src/renderer/src/components/dialogs/SearchDialog.tsx
  - src/renderer/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can open search modal via Cmd/Ctrl+K"
    - "Search finds tasks and projects by title"
    - "Results display project and task icons"
    - "Selecting result navigates to it"
  artifacts:
    - path: "src/renderer/src/components/ui/command.tsx"
      provides: "shadcn Command primitives"
    - path: "src/renderer/src/components/dialogs/SearchDialog.tsx"
      provides: "Search modal component"
      exports: ["SearchDialog"]
    - path: "src/renderer/src/App.tsx"
      provides: "Search integration"
      contains: "searchOpen"
  key_links:
    - from: "App.tsx"
      to: "SearchDialog"
      via: "import and render"
      pattern: "SearchDialog"
    - from: "SearchDialog"
      to: "onSelectTask/onSelectProject"
      via: "CommandItem onSelect"
      pattern: "onSelect.*=>"
---

<objective>
Implement global search modal with Cmd/Ctrl+K shortcut.

Purpose: Let users quickly find and navigate to any task or project.
Output: SearchDialog component wired into App.tsx with keyboard shortcut.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-search/09-RESEARCH.md
@src/renderer/src/App.tsx
@src/renderer/src/components/dialogs/UserSettingsDialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn command and create SearchDialog</name>
  <files>
    src/renderer/src/components/ui/command.tsx
    src/renderer/src/components/dialogs/SearchDialog.tsx
  </files>
  <action>
1. Install shadcn command component:
   ```bash
   cd src/renderer && pnpm dlx shadcn@latest add command
   ```
   This adds command.tsx to components/ui/ and installs cmdk dependency.

2. Create SearchDialog.tsx in components/dialogs/:
   - Props: open, onOpenChange, tasks, projects, onSelectTask, onSelectProject
   - Use CommandDialog, CommandInput, CommandList, CommandEmpty, CommandGroup, CommandItem
   - Filter tasks to top-level only: `tasks.filter(t => !t.parent_id)`
   - Two CommandGroups: "Projects" and "Tasks"
   - Projects: Folder icon (lucide-react), project.name as value
   - Tasks: CheckSquare icon, task.title as value
   - Add keywords prop to task items with project name for cross-search
   - onSelect: call handler then close dialog via onOpenChange(false)
  </action>
  <verify>
    - command.tsx exists in components/ui/
    - SearchDialog.tsx compiles without errors
    - `pnpm typecheck` passes
  </verify>
  <done>
    - SearchDialog component created with proper types
    - Uses shadcn Command primitives
    - Folder and CheckSquare icons distinguish types
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire SearchDialog into App.tsx</name>
  <files>src/renderer/src/App.tsx</files>
  <action>
1. Add import: `import { SearchDialog } from '@/components/dialogs/SearchDialog'`

2. Add state: `const [searchOpen, setSearchOpen] = useState(false)`

3. Add hotkey after existing useHotkeys calls:
   ```typescript
   useHotkeys('mod+k', (e) => {
     e.preventDefault()
     setSearchOpen(true)
   }, { enableOnFormTags: true })
   ```

4. Update escape handler - add condition:
   `if (searchOpen) return`
   Add this check after existing dialog checks (before view navigation).

5. Add SearchDialog component in JSX (after UserSettingsDialog):
   ```tsx
   <SearchDialog
     open={searchOpen}
     onOpenChange={setSearchOpen}
     tasks={tasks}
     projects={projects}
     onSelectTask={openTaskDetail}
     onSelectProject={setSelectedProjectId}
   />
   ```
  </action>
  <verify>
    - `pnpm typecheck` passes
    - `pnpm dev` - app loads without errors
    - Cmd+K (Mac) or Ctrl+K (Windows) opens search modal
    - Typing filters results
    - Clicking project selects it in sidebar
    - Clicking task opens task detail
  </verify>
  <done>
    - Search modal opens via Cmd/Ctrl+K from anywhere
    - Search works across all projects and tasks
    - Results show distinguishing icons
    - Selecting result navigates appropriately
  </done>
</task>

</tasks>

<verification>
All requirements satisfied:
- SEARCH-01: Cmd/Ctrl+K opens modal (enableOnFormTags: true works in inputs)
- SEARCH-02: cmdk fuzzy search across tasks/projects
- SEARCH-03: Folder icon for projects, CheckSquare for tasks
- SEARCH-04: onSelectTask -> openTaskDetail, onSelectProject -> setSelectedProjectId
</verification>

<success_criteria>
1. Cmd+K opens search modal from kanban, task detail, or work mode
2. Typing filters tasks and projects by title
3. Projects show folder icon, tasks show checkbox icon
4. Clicking project selects it (returns to kanban if not there)
5. Clicking task opens task detail page
6. Esc or clicking outside closes modal
</success_criteria>

<output>
After completion, create `.planning/phases/09-search/09-01-SUMMARY.md`
</output>
