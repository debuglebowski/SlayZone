---
phase: 08-theme-system
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/renderer/src/contexts/ThemeContext.tsx
  - src/renderer/src/main.tsx
  - src/renderer/src/components/dialogs/UserSettingsDialog.tsx
autonomous: true

must_haves:
  truths:
    - "User can toggle between light, dark, and system theme"
    - "App respects system theme when set to system"
    - "Theme changes reflect immediately in UI"
  artifacts:
    - path: "src/renderer/src/contexts/ThemeContext.tsx"
      provides: "ThemeProvider and useTheme hook"
      exports: ["ThemeProvider", "useTheme"]
    - path: "src/renderer/src/components/dialogs/UserSettingsDialog.tsx"
      provides: "Theme toggle UI"
      contains: "setPreference"
  key_links:
    - from: "src/renderer/src/main.tsx"
      to: "ThemeContext.tsx"
      via: "ThemeProvider wrapper"
      pattern: "<ThemeProvider>"
    - from: "src/renderer/src/contexts/ThemeContext.tsx"
      to: "window.api.theme"
      via: "IPC calls"
      pattern: "window\\.api\\.theme"
    - from: "UserSettingsDialog.tsx"
      to: "ThemeContext.tsx"
      via: "useTheme hook"
      pattern: "useTheme\\(\\)"
---

<objective>
Create React ThemeContext and add theme toggle to settings.

Purpose: Expose theme state to all components, provide UI for user control
Output: Working theme toggle in settings that persists selection
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/08-theme-system/08-RESEARCH.md
@src/renderer/src/main.tsx
@src/renderer/src/components/dialogs/UserSettingsDialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ThemeContext with provider and hook</name>
  <files>
    src/renderer/src/contexts/ThemeContext.tsx
    src/renderer/src/main.tsx
  </files>
  <action>
Create `src/renderer/src/contexts/ThemeContext.tsx`:
- Types: Theme = 'light' | 'dark', ThemePreference = 'light' | 'dark' | 'system'
- ThemeContextValue: { theme: Theme, preference: ThemePreference, setPreference: (pref: ThemePreference) => Promise<void> }
- ThemeProvider component:
  - State: theme (effective), preference (user choice)
  - useEffect on mount: call window.api.theme.getEffective() and getSource() to initialize
  - useEffect on mount: subscribe to window.api.theme.onChange to update theme state
  - useEffect on theme change: toggle .dark class on document.documentElement
  - setPreference: call window.api.theme.set(), update local state with result
- useTheme hook: throws if used outside provider

Modify `src/renderer/src/main.tsx`:
- Import ThemeProvider from './contexts/ThemeContext'
- Wrap App in ThemeProvider (inside StrictMode)
  </action>
  <verify>
`npm run build` succeeds
App starts without console errors
  </verify>
  <done>
ThemeProvider wraps App
useTheme hook available throughout app
.dark class toggles on html element based on theme state
  </done>
</task>

<task type="auto">
  <name>Task 2: Add theme toggle to UserSettingsDialog</name>
  <files>src/renderer/src/components/dialogs/UserSettingsDialog.tsx</files>
  <action>
Modify UserSettingsDialog:
- Import useTheme from '@/contexts/ThemeContext'
- Import Select, SelectContent, SelectItem, SelectTrigger, SelectValue from '@/components/ui/select'
- Add theme section BEFORE tags section:
```tsx
<div className="space-y-2">
  <Label className="text-base font-semibold">Appearance</Label>
  <div className="flex items-center justify-between">
    <span className="text-sm">Theme</span>
    <Select value={preference} onValueChange={(v) => setPreference(v as ThemePreference)}>
      <SelectTrigger className="w-32">
        <SelectValue />
      </SelectTrigger>
      <SelectContent>
        <SelectItem value="light">Light</SelectItem>
        <SelectItem value="dark">Dark</SelectItem>
        <SelectItem value="system">System</SelectItem>
      </SelectContent>
    </Select>
  </div>
</div>
<Separator />
```
- Get preference and setPreference from useTheme()
  </action>
  <verify>
`npm run dev` - open Settings dialog
Theme dropdown visible with Light/Dark/System options
Selecting option changes theme immediately
Close and reopen app - theme persists
Change OS theme while set to "System" - app updates
  </verify>
  <done>
Theme toggle visible in settings
Selection persists across restarts
System option follows OS theme changes
  </done>
</task>

</tasks>

<verification>
1. `npm run dev` - app starts
2. Open Settings -> Theme dropdown visible
3. Select "Dark" -> UI switches to dark mode immediately
4. Select "Light" -> UI switches to light mode immediately
5. Select "System" -> UI matches OS theme
6. Close app, reopen -> theme persisted
7. While on "System", change OS theme -> app updates
</verification>

<success_criteria>
- User can toggle between light, dark, and system theme
- Theme persists across app restarts
- System theme changes apply automatically when set to "system"
</success_criteria>

<output>
After completion, create `.planning/phases/08-theme-system/08-02-SUMMARY.md`
</output>
