---
phase: 07-polish
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/src/lib/prioritization.ts
  - src/renderer/src/hooks/useWhatNext.ts
  - src/renderer/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "What Next suggests highest-priority non-blocked task"
    - "Overdue tasks rank higher than non-overdue"
    - "P1 tasks rank higher than P5 tasks"
    - "Blocked and done tasks are excluded"
  artifacts:
    - path: "src/renderer/src/lib/prioritization.ts"
      provides: "Priority scoring algorithm"
      exports: ["calculatePriorityScore", "getNextTask"]
    - path: "src/renderer/src/hooks/useWhatNext.ts"
      provides: "Hook for suggested task"
      exports: ["useWhatNext"]
    - path: "src/renderer/src/App.tsx"
      provides: "What Next UI display"
      contains: "whatNextTask"
  key_links:
    - from: "useWhatNext.ts"
      to: "prioritization.ts getNextTask"
      via: "import and call"
      pattern: "getNextTask"
    - from: "App.tsx"
      to: "useWhatNext"
      via: "hook call"
      pattern: "useWhatNext"
---

<objective>
Implement "What Next" prioritization

Purpose: Complete UX-01 - suggest highest-priority task to user
Output: Header shows suggested next task based on due date + priority
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-polish/07-RESEARCH.md
@src/renderer/src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create prioritization logic</name>
  <files>src/renderer/src/lib/prioritization.ts</files>
  <action>
Create new file with priority scoring algorithm:

```typescript
import { differenceInDays, parseISO, startOfDay } from 'date-fns'
import type { Task } from '../../../shared/types/database'

export function calculatePriorityScore(task: Task): number {
  // Skip blocked and done tasks
  if (task.blocked_reason || task.status === 'done') return -Infinity

  // Base score from priority (P1=1000, P2=800, P3=600, P4=400, P5=200)
  const priorityScore = (6 - task.priority) * 200

  // Due date urgency
  let dueDateScore = 0
  if (task.due_date) {
    const today = startOfDay(new Date())
    const dueDate = startOfDay(parseISO(task.due_date))
    const daysUntilDue = differenceInDays(dueDate, today)

    if (daysUntilDue < 0) {
      // Overdue: big boost, capped
      dueDateScore = 500 + Math.min(Math.abs(daysUntilDue) * 50, 500)
    } else if (daysUntilDue === 0) {
      dueDateScore = 400 // Due today
    } else if (daysUntilDue <= 3) {
      dueDateScore = 300 - daysUntilDue * 50 // Due soon
    } else if (daysUntilDue <= 7) {
      dueDateScore = 100 // Due this week
    }
  }

  // Status boost
  let statusScore = 0
  if (task.status === 'in_progress') statusScore = 100
  else if (task.status === 'review') statusScore = 75
  else if (task.status === 'todo') statusScore = 50

  return priorityScore + dueDateScore + statusScore
}

export function getNextTask(tasks: Task[]): Task | null {
  const scored = tasks
    .map(task => ({ task, score: calculatePriorityScore(task) }))
    .filter(s => s.score > -Infinity)
    .sort((a, b) => b.score - a.score)

  return scored[0]?.task ?? null
}
```
  </action>
  <verify>`npm run typecheck` passes</verify>
  <done>prioritization.ts exports scoring functions</done>
</task>

<task type="auto">
  <name>Task 2: Create useWhatNext hook</name>
  <files>src/renderer/src/hooks/useWhatNext.ts</files>
  <action>
Create hook that memoizes priority calculation:

```typescript
import { useMemo } from 'react'
import { getNextTask } from '@/lib/prioritization'
import type { Task } from '../../../shared/types/database'

export function useWhatNext(tasks: Task[]): Task | null {
  return useMemo(() => getNextTask(tasks), [tasks])
}
```
  </action>
  <verify>`npm run typecheck` passes</verify>
  <done>useWhatNext hook exists</done>
</task>

<task type="auto">
  <name>Task 3: Add What Next UI to header</name>
  <files>src/renderer/src/App.tsx</files>
  <action>
Add "What Next" display in kanban header:

1. Import hook: `import { useWhatNext } from '@/hooks/useWhatNext'`

2. Call hook after projectTasks calculation:
```typescript
const whatNextTask = useWhatNext(projectTasks)
```

3. Add UI in header area (between h1 and Button):
```tsx
{whatNextTask && (
  <div
    className="flex items-center gap-2 px-3 py-1.5 bg-muted rounded-md cursor-pointer hover:bg-muted/80"
    onClick={() => openTaskDetail(whatNextTask.id)}
  >
    <span className="text-sm text-muted-foreground">Next:</span>
    <span className="text-sm font-medium truncate max-w-[200px]">
      {whatNextTask.title}
    </span>
  </div>
)}
```

Place in header flex container so it appears between title and New Task button.
  </action>
  <verify>
Open app with tasks, verify "Next: [task title]" appears in header.
Click it -> opens task detail page.
  </verify>
  <done>What Next displays in header and is clickable</done>
</task>

</tasks>

<verification>
- [ ] `npm run typecheck` passes
- [ ] What Next shows highest-priority task
- [ ] Blocked tasks excluded from suggestion
- [ ] Done tasks excluded from suggestion
- [ ] Clicking What Next opens task detail
</verification>

<success_criteria>
What Next feature suggests best task based on priority + due date algorithm.
</success_criteria>

<output>
After completion, create `.planning/phases/07-polish/07-03-SUMMARY.md`
</output>
