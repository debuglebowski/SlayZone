---
phase: 07-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/renderer/src/lib/schemas.ts
  - src/renderer/src/components/CreateTaskDialog.tsx
autonomous: true

must_haves:
  truths:
    - "User can select tags when creating a new task"
    - "Selected tags persist after task creation"
  artifacts:
    - path: "src/renderer/src/lib/schemas.ts"
      provides: "tagIds field in createTaskSchema"
      contains: "tagIds: z.array"
    - path: "src/renderer/src/components/CreateTaskDialog.tsx"
      provides: "Tag selection UI in form"
      contains: "tagIds"
  key_links:
    - from: "CreateTaskDialog.tsx"
      to: "window.api.taskTags.setTagsForTask"
      via: "onSubmit handler"
      pattern: "setTagsForTask"
---

<objective>
Add tag selection to CreateTaskDialog

Purpose: Complete UX-03 - CreateTaskDialog currently missing tags field
Output: Users can assign tags when creating tasks
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-polish/07-RESEARCH.md

# Existing tag selection pattern
@src/renderer/src/components/task-detail/TaskMetadataRow.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend schema and form type</name>
  <files>src/renderer/src/lib/schemas.ts</files>
  <action>
Add tagIds field to createTaskSchema:
- `tagIds: z.array(z.string()).default([])`
- Add tagIds to CreateTaskFormData interface: `tagIds: string[]`
- Keep default empty array for backward compatibility
  </action>
  <verify>`npm run typecheck` passes</verify>
  <done>createTaskSchema includes tagIds field</done>
</task>

<task type="auto">
  <name>Task 2: Add tag selection to CreateTaskDialog</name>
  <files>src/renderer/src/components/CreateTaskDialog.tsx</files>
  <action>
Add tag multi-select using existing Popover+Checkbox pattern from TaskMetadataRow:

1. Add props: accept `tags: Tag[]` prop (already available from App.tsx)
2. Add form field for tagIds in useForm defaultValues: `tagIds: []`
3. Add form reset to include tagIds: [] in useEffect
4. Add FormField for tags using Popover pattern:
   - Popover trigger shows "Select tags..." or "{n} selected"
   - PopoverContent with Checkbox list for each tag
   - Checkbox onCheckedChange updates field.value array
5. Update onSubmit to call setTagsForTask after createTask:
   ```typescript
   const task = await window.api.db.createTask({...})
   if (data.tagIds.length > 0) {
     await window.api.taskTags.setTagsForTask(task.id, data.tagIds)
   }
   onCreated(task)
   ```

Import Tag type from shared/types/database.
Import Checkbox from @/components/ui/checkbox.
  </action>
  <verify>
Open app, click "New Task", verify tags dropdown appears.
Select tags, create task, verify tags appear on task detail page.
  </verify>
  <done>CreateTaskDialog has working tag selection that persists</done>
</task>

</tasks>

<verification>
- [ ] `npm run typecheck` passes
- [ ] Create task with tags -> tags visible in task detail
- [ ] Create task without tags -> no error
</verification>

<success_criteria>
Tags can be selected in CreateTaskDialog and persist after task creation.
</success_criteria>

<output>
After completion, create `.planning/phases/07-polish/07-01-SUMMARY.md`
</output>
