---
phase: 10-task-lifecycle
plan: 02
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - src/renderer/src/components/task-detail/TaskDetailPage.tsx
  - src/renderer/src/components/sidebar/AppSidebar.tsx
  - src/renderer/src/components/ArchivedTasksView.tsx
  - src/renderer/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can archive task from TaskDetailPage"
    - "User can delete task from TaskDetailPage"
    - "Archived tasks visible via sidebar navigation"
    - "User can unarchive task from ArchivedTasksView"
  artifacts:
    - path: "src/renderer/src/components/task-detail/TaskDetailPage.tsx"
      provides: "Action dropdown with Archive and Delete"
      contains: "DropdownMenu"
    - path: "src/renderer/src/components/ArchivedTasksView.tsx"
      provides: "List of archived tasks with unarchive action"
      contains: "getArchivedTasks"
    - path: "src/renderer/src/components/sidebar/AppSidebar.tsx"
      provides: "Archive navigation item"
      contains: "onSelectArchive"
  key_links:
    - from: "TaskDetailPage"
      to: "api.db.archiveTask"
      via: "onClick handler"
      pattern: "archiveTask"
    - from: "AppSidebar"
      to: "App.tsx"
      via: "onSelectArchive callback"
      pattern: "onSelectArchive"
---

<objective>
Add archive/delete UI to TaskDetailPage and create ArchivedTasksView accessible from sidebar.

Purpose: User-facing archive and delete functionality with recovery path.
Output: Action dropdown on task detail, Archive sidebar item, ArchivedTasksView component.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-task-lifecycle/10-RESEARCH.md
@.planning/phases/10-task-lifecycle/10-01-SUMMARY.md

@src/renderer/src/components/task-detail/TaskDetailPage.tsx
@src/renderer/src/components/sidebar/AppSidebar.tsx
@src/renderer/src/components/DeleteTaskDialog.tsx
@src/renderer/src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add action dropdown to TaskDetailPage header</name>
  <files>src/renderer/src/components/task-detail/TaskDetailPage.tsx</files>
  <action>
Import: MoreHorizontal, Archive, Trash2 from lucide-react
Import: DropdownMenu components from @/components/ui/dropdown-menu
Import: DeleteTaskDialog from @/components/DeleteTaskDialog

Add state: const [deleteDialogOpen, setDeleteDialogOpen] = useState(false)

Add handler functions:
- handleArchive: call window.api.db.archiveTask(task.id), then onBack() to return to kanban
- handleDeleteConfirm: close dialog, call onBack()

In header, after Work Mode button (or in same area if no onWorkMode):
Add DropdownMenu with MoreHorizontal trigger (ghost button, icon size).
Content align="end":
- DropdownMenuItem with Archive icon: "Archive" - onClick={handleArchive}
- DropdownMenuSeparator
- DropdownMenuItem with Trash2 icon, className="text-destructive": "Delete" - onClick={() => setDeleteDialogOpen(true)}

Add DeleteTaskDialog at bottom of component:
<DeleteTaskDialog task={task} open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen} onDeleted={handleDeleteConfirm} />

Props interface needs: onDeleted?: () => void for when task is deleted/archived and we need to refresh parent.
  </action>
  <verify>npm run typecheck passes</verify>
  <done>TaskDetailPage has action dropdown with Archive and Delete options</done>
</task>

<task type="auto">
  <name>Task 2: Create ArchivedTasksView component</name>
  <files>src/renderer/src/components/ArchivedTasksView.tsx</files>
  <action>
Create new component src/renderer/src/components/ArchivedTasksView.tsx:

Props: onBack: () => void, onTaskClick: (taskId: string) => void

State:
- tasks: Task[]
- loading: boolean

useEffect: Load archived tasks via window.api.db.getArchivedTasks()

Render:
- Header with ArrowLeft back button and title "Archived Tasks"
- If loading, show "Loading..."
- If no tasks, show empty state "No archived tasks"
- List of tasks (simple, not kanban):
  - Each item: task title, project color dot (need to load projects), date archived
  - Hover: show Undo icon button to unarchive
  - On unarchive: call window.api.db.unarchiveTask(id), refresh list
  - Click task title: onTaskClick(task.id)

Style: Use similar layout to task detail page (max-w-4xl container).
  </action>
  <verify>npm run typecheck passes</verify>
  <done>ArchivedTasksView component renders archived tasks with unarchive action</done>
</task>

<task type="auto">
  <name>Task 3: Add Archive nav item to sidebar and wire in App</name>
  <files>src/renderer/src/components/sidebar/AppSidebar.tsx, src/renderer/src/App.tsx</files>
  <action>
In AppSidebar:
1. Import Archive from lucide-react
2. Add prop: onSelectArchive: () => void
3. Add prop: showArchiveSelected?: boolean
4. After "All" button, before projects list, add Archive button:
   - Same style as "All" button (w-10 h-10 rounded-lg)
   - Archive icon inside
   - onClick={onSelectArchive}
   - title="Archived tasks"
   - Selected ring when showArchiveSelected is true

In App.tsx:
1. Add view state: 'kanban' | 'task' | 'workMode' | 'settings' | 'tutorial' | 'archived'
2. Add handler: handleSelectArchive = () => setView('archived')
3. Pass onSelectArchive={handleSelectArchive} to AppSidebar
4. Pass showArchiveSelected={view === 'archived'} to AppSidebar
5. Render ArchivedTasksView when view === 'archived':
   <ArchivedTasksView onBack={() => setView('kanban')} onTaskClick={(id) => { setSelectedTaskId(id); setView('task') }} />
6. When archive selected, clear selectedProjectId (similar to settings view logic)
  </action>
  <verify>npm run typecheck passes, npm run lint passes</verify>
  <done>Sidebar has Archive button, clicking shows ArchivedTasksView</done>
</task>

</tasks>

<verification>
1. npm run typecheck - no errors
2. npm run lint - no errors
3. Manual test flow:
   - Create task, go to task detail
   - Click ... menu, click Archive - task disappears from kanban
   - Click Archive in sidebar - see archived task
   - Click Undo on archived task - task returns to kanban
   - Create another task, delete it - confirm dialog, task gone permanently
</verification>

<success_criteria>
- TaskDetailPage has action dropdown with Archive and Delete
- Delete shows confirmation dialog (uses existing DeleteTaskDialog)
- Sidebar has Archive navigation item
- ArchivedTasksView shows archived tasks with unarchive option
- Full archive/unarchive/delete flow works end-to-end
</success_criteria>

<output>
After completion, create `.planning/phases/10-task-lifecycle/10-02-SUMMARY.md`
</output>
