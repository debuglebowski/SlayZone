---
phase: 06-work-mode
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/index.ts
  - src/renderer/src/App.tsx
  - src/renderer/src/components/work-mode/WorkModePage.tsx
  - src/renderer/src/components/task-detail/TaskDetailPage.tsx
autonomous: true

must_haves:
  truths:
    - "User can enter Work Mode from task detail page"
    - "User can return to task detail from Work Mode"
    - "Webview tag renders external URLs"
  artifacts:
    - path: "src/main/index.ts"
      provides: "webviewTag: true in BrowserWindow config"
      contains: "webviewTag: true"
    - path: "src/renderer/src/App.tsx"
      provides: "ViewState includes work-mode type"
      contains: "type: 'work-mode'"
    - path: "src/renderer/src/components/work-mode/WorkModePage.tsx"
      provides: "Work Mode container with sidebar placeholder"
      min_lines: 30
    - path: "src/renderer/src/components/task-detail/TaskDetailPage.tsx"
      provides: "Work Mode button in header"
      contains: "onWorkMode"
  key_links:
    - from: "src/renderer/src/App.tsx"
      to: "WorkModePage"
      via: "conditional render on view.type === 'work-mode'"
      pattern: "work-mode"
    - from: "TaskDetailPage"
      to: "App.tsx"
      via: "onWorkMode callback"
      pattern: "onWorkMode"
---

<objective>
Enable webview tag and create Work Mode container with navigation.

Purpose: Infrastructure for browser tabs (webviewTag) and navigation flow (detail -> work mode -> back).
Output: WorkModePage component, extended ViewState, webview support enabled.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/main/index.ts
@src/renderer/src/App.tsx
@src/renderer/src/components/task-detail/TaskDetailPage.tsx
@.planning/phases/06-work-mode/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enable webviewTag and create WorkModePage</name>
  <files>src/main/index.ts, src/renderer/src/components/work-mode/WorkModePage.tsx</files>
  <action>
**src/main/index.ts:**
In createWindow(), add webviewTag: true to webPreferences:

```typescript
webPreferences: {
  preload: join(__dirname, '../preload/index.js'),
  sandbox: true,
  contextIsolation: true,
  nodeIntegration: false,
  webviewTag: true  // Required for <webview> in Work Mode browser tabs
}
```

**src/renderer/src/components/work-mode/WorkModePage.tsx:**
Create component with:
- Props: taskId, onBack callback
- Load task data via window.api.db.getTask
- Layout: header with back button + task title, main area split into sidebar + content
- Sidebar placeholder, content placeholder

```typescript
import { useState, useEffect } from 'react'
import { ArrowLeft } from 'lucide-react'
import type { Task } from '../../../../shared/types/database'
import { Button } from '@/components/ui/button'

interface Props {
  taskId: string
  onBack: () => void
}

export function WorkModePage({ taskId, onBack }: Props) {
  const [task, setTask] = useState<Task | null>(null)

  useEffect(() => {
    window.api.db.getTask(taskId).then(setTask)
  }, [taskId])

  if (!task) return <div className="p-6">Loading...</div>

  return (
    <div className="flex flex-col h-screen">
      <header className="flex items-center gap-4 p-4 border-b">
        <Button variant="ghost" size="icon" onClick={onBack}>
          <ArrowLeft className="h-4 w-4" />
        </Button>
        <h1 className="text-lg font-semibold">{task.title}</h1>
        <span className="text-sm text-muted-foreground">Work Mode</span>
      </header>
      <div className="flex flex-1 min-h-0">
        <aside className="w-64 border-r p-4">
          <p className="text-sm text-muted-foreground">Workspace items</p>
        </aside>
        <main className="flex-1 p-4">
          <p className="text-muted-foreground">Select an item</p>
        </main>
      </div>
    </div>
  )
}
```
  </action>
  <verify>npm run typecheck passes</verify>
  <done>webviewTag enabled, WorkModePage component created</done>
</task>

<task type="auto">
  <name>Task 2: Wire navigation in App.tsx and TaskDetailPage</name>
  <files>src/renderer/src/App.tsx, src/renderer/src/components/task-detail/TaskDetailPage.tsx</files>
  <action>
**src/renderer/src/App.tsx:**

1. Extend ViewState union:
```typescript
type ViewState =
  | { type: 'kanban' }
  | { type: 'task-detail'; taskId: string }
  | { type: 'work-mode'; taskId: string }
```

2. Add import at top:
```typescript
import { WorkModePage } from '@/components/work-mode/WorkModePage'
```

3. Add navigation handlers after closeTaskDetail:
```typescript
const openWorkMode = (taskId: string): void => {
  setView({ type: 'work-mode', taskId })
}

const closeWorkMode = (): void => {
  // Return to task detail, not kanban
  if (view.type === 'work-mode') {
    setView({ type: 'task-detail', taskId: view.taskId })
  }
}
```

4. Add conditional render BEFORE task-detail check (around line 189):
```typescript
// Work Mode view
if (view.type === 'work-mode') {
  return (
    <WorkModePage
      taskId={view.taskId}
      onBack={closeWorkMode}
    />
  )
}
```

5. Pass onWorkMode to TaskDetailPage:
```typescript
<TaskDetailPage
  taskId={view.taskId}
  onBack={closeTaskDetail}
  onTaskUpdated={handleTaskDetailUpdated}
  onWorkMode={() => openWorkMode(view.taskId)}
/>
```

**src/renderer/src/components/task-detail/TaskDetailPage.tsx:**

1. Add onWorkMode to props interface:
```typescript
interface TaskDetailPageProps {
  taskId: string
  onBack: () => void
  onTaskUpdated: (task: Task) => void
  onWorkMode?: () => void
}
```

2. Destructure in component:
```typescript
export function TaskDetailPage({
  taskId,
  onBack,
  onTaskUpdated,
  onWorkMode
}: TaskDetailPageProps)
```

3. Add Work Mode button in header (after title h1, inside the flex div):
```typescript
{onWorkMode && (
  <Button variant="outline" size="sm" onClick={onWorkMode} className="ml-auto">
    Work Mode
  </Button>
)}
```
  </action>
  <verify>npm run typecheck passes</verify>
  <done>ViewState extended, navigation wired, Work Mode button in TaskDetailPage header</done>
</task>

</tasks>

<verification>
- [ ] npm run typecheck passes
- [ ] webviewTag: true in src/main/index.ts
- [ ] ViewState includes work-mode type
- [ ] WorkModePage component exists with correct props
- [ ] TaskDetailPage has Work Mode button that calls onWorkMode
</verification>

<success_criteria>
User can click "Work Mode" button on task detail page to enter Work Mode and return via back button.
</success_criteria>

<output>
After completion, create `.planning/phases/06-work-mode/06-02-SUMMARY.md`
</output>
