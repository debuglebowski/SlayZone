---
phase: 06-work-mode
plan: 03
type: execute
wave: 2
depends_on: [06-01, 06-02]
files_modified:
  - src/renderer/src/components/work-mode/WorkspaceSidebar.tsx
  - src/renderer/src/components/work-mode/WorkspaceItemCard.tsx
  - src/renderer/src/components/work-mode/WorkModePage.tsx
autonomous: true

must_haves:
  truths:
    - "Sidebar shows list of workspace items for task"
    - "User can add new chat/browser/document item"
    - "User can rename workspace item via context menu"
    - "User can delete workspace item via context menu"
    - "Clicking item sets it as active"
  artifacts:
    - path: "src/renderer/src/components/work-mode/WorkspaceSidebar.tsx"
      provides: "Sidebar with item list and add buttons"
      min_lines: 50
    - path: "src/renderer/src/components/work-mode/WorkspaceItemCard.tsx"
      provides: "Item card with icon, name, context menu"
      min_lines: 40
    - path: "src/renderer/src/components/work-mode/WorkModePage.tsx"
      provides: "Integrated sidebar with item state management"
      contains: "WorkspaceSidebar"
  key_links:
    - from: "WorkspaceSidebar"
      to: "window.api.workspaceItems"
      via: "create/delete calls"
      pattern: "workspaceItems\\.(create|delete)"
    - from: "WorkModePage"
      to: "WorkspaceSidebar"
      via: "items prop and callbacks"
      pattern: "WorkspaceSidebar"
---

<objective>
Build workspace sidebar with item list, add buttons, and context menu actions.

Purpose: Users can manage workspace items (add chat/browser/document, rename, delete).
Output: WorkspaceSidebar, WorkspaceItemCard components integrated into WorkModePage.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/shared/types/database.ts
@src/renderer/src/components/work-mode/WorkModePage.tsx
@.planning/phases/06-work-mode/06-01-PLAN.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WorkspaceItemCard with context menu</name>
  <files>src/renderer/src/components/work-mode/WorkspaceItemCard.tsx</files>
  <action>
Create component with:
- Props: item (WorkspaceItem), isActive, onClick, onRename, onDelete
- Icon based on item.type: MessageSquare for chat, Globe for browser, FileText for document
- Context menu with Rename and Delete options
- Active state styling (bg-accent)

```typescript
import { useState } from 'react'
import { MessageSquare, Globe, FileText, MoreVertical } from 'lucide-react'
import type { WorkspaceItem } from '../../../../shared/types/database'
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger
} from '@/components/ui/dropdown-menu'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { cn } from '@/lib/utils'

interface Props {
  item: WorkspaceItem
  isActive: boolean
  onClick: () => void
  onRename: (name: string) => void
  onDelete: () => void
}

const typeIcons = {
  chat: MessageSquare,
  browser: Globe,
  document: FileText
}

export function WorkspaceItemCard({ item, isActive, onClick, onRename, onDelete }: Props) {
  const [editing, setEditing] = useState(false)
  const [name, setName] = useState(item.name)
  const Icon = typeIcons[item.type]

  const handleRename = () => {
    if (name.trim() && name !== item.name) {
      onRename(name.trim())
    }
    setEditing(false)
  }

  const handleKeyDown = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter') handleRename()
    if (e.key === 'Escape') { setName(item.name); setEditing(false) }
  }

  return (
    <div
      className={cn(
        'flex items-center gap-2 px-2 py-1.5 rounded-md cursor-pointer group',
        isActive ? 'bg-accent' : 'hover:bg-muted'
      )}
      onClick={editing ? undefined : onClick}
    >
      <Icon className="h-4 w-4 shrink-0 text-muted-foreground" />
      {editing ? (
        <Input
          value={name}
          onChange={(e) => setName(e.target.value)}
          onBlur={handleRename}
          onKeyDown={handleKeyDown}
          className="h-6 text-sm"
          autoFocus
          onClick={(e) => e.stopPropagation()}
        />
      ) : (
        <span className="flex-1 truncate text-sm">{item.name}</span>
      )}
      <DropdownMenu>
        <DropdownMenuTrigger asChild onClick={(e) => e.stopPropagation()}>
          <Button
            variant="ghost"
            size="icon"
            className="h-6 w-6 opacity-0 group-hover:opacity-100"
          >
            <MoreVertical className="h-3 w-3" />
          </Button>
        </DropdownMenuTrigger>
        <DropdownMenuContent align="end">
          <DropdownMenuItem onClick={() => setEditing(true)}>
            Rename
          </DropdownMenuItem>
          <DropdownMenuItem onClick={onDelete} className="text-destructive">
            Delete
          </DropdownMenuItem>
        </DropdownMenuContent>
      </DropdownMenu>
    </div>
  )
}
```
  </action>
  <verify>File exists and npm run typecheck passes</verify>
  <done>WorkspaceItemCard renders item with icon, name, inline rename, context menu</done>
</task>

<task type="auto">
  <name>Task 2: Create WorkspaceSidebar with add buttons</name>
  <files>src/renderer/src/components/work-mode/WorkspaceSidebar.tsx</files>
  <action>
Create component with:
- Props: items, activeItemId, onSelectItem, onAddItem, onRenameItem, onDeleteItem
- List of WorkspaceItemCard components
- Add buttons row at bottom: Chat, Browser, Document

```typescript
import { Plus, MessageSquare, Globe, FileText } from 'lucide-react'
import type { WorkspaceItem, WorkspaceItemType } from '../../../../shared/types/database'
import { Button } from '@/components/ui/button'
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger
} from '@/components/ui/dropdown-menu'
import { WorkspaceItemCard } from './WorkspaceItemCard'

interface Props {
  items: WorkspaceItem[]
  activeItemId: string | null
  onSelectItem: (id: string) => void
  onAddItem: (type: WorkspaceItemType) => void
  onRenameItem: (id: string, name: string) => void
  onDeleteItem: (id: string) => void
}

export function WorkspaceSidebar({
  items,
  activeItemId,
  onSelectItem,
  onAddItem,
  onRenameItem,
  onDeleteItem
}: Props) {
  return (
    <aside className="w-64 border-r flex flex-col">
      <div className="p-2 border-b flex items-center justify-between">
        <span className="text-sm font-medium">Workspace</span>
        <DropdownMenu>
          <DropdownMenuTrigger asChild>
            <Button variant="ghost" size="icon" className="h-6 w-6">
              <Plus className="h-4 w-4" />
            </Button>
          </DropdownMenuTrigger>
          <DropdownMenuContent align="end">
            <DropdownMenuItem onClick={() => onAddItem('chat')}>
              <MessageSquare className="h-4 w-4 mr-2" />
              Chat
            </DropdownMenuItem>
            <DropdownMenuItem onClick={() => onAddItem('browser')}>
              <Globe className="h-4 w-4 mr-2" />
              Browser Tab
            </DropdownMenuItem>
            <DropdownMenuItem onClick={() => onAddItem('document')}>
              <FileText className="h-4 w-4 mr-2" />
              Document
            </DropdownMenuItem>
          </DropdownMenuContent>
        </DropdownMenu>
      </div>
      <div className="flex-1 overflow-y-auto p-2 space-y-1">
        {items.length === 0 ? (
          <p className="text-sm text-muted-foreground text-center py-4">
            No items yet
          </p>
        ) : (
          items.map((item) => (
            <WorkspaceItemCard
              key={item.id}
              item={item}
              isActive={item.id === activeItemId}
              onClick={() => onSelectItem(item.id)}
              onRename={(name) => onRenameItem(item.id, name)}
              onDelete={() => onDeleteItem(item.id)}
            />
          ))
        )}
      </div>
    </aside>
  )
}
```
  </action>
  <verify>File exists and npm run typecheck passes</verify>
  <done>WorkspaceSidebar renders item list with add dropdown and item cards</done>
</task>

<task type="auto">
  <name>Task 3: Integrate sidebar into WorkModePage</name>
  <files>src/renderer/src/components/work-mode/WorkModePage.tsx</files>
  <action>
Update WorkModePage to:
1. Load workspace items on mount via window.api.workspaceItems.getByTask
2. Manage items state and activeItemId state
3. Implement handlers: handleAddItem, handleRenameItem, handleDeleteItem
4. Replace placeholder sidebar with WorkspaceSidebar component

Add imports:
```typescript
import type { Task, WorkspaceItem, WorkspaceItemType } from '../../../../shared/types/database'
import { WorkspaceSidebar } from './WorkspaceSidebar'
```

Add state:
```typescript
const [items, setItems] = useState<WorkspaceItem[]>([])
const [activeItemId, setActiveItemId] = useState<string | null>(null)
```

Add useEffect to load items:
```typescript
useEffect(() => {
  window.api.workspaceItems.getByTask(taskId).then(setItems)
}, [taskId])
```

Add handlers:
```typescript
const handleAddItem = async (type: WorkspaceItemType) => {
  const names = { chat: 'Chat', browser: 'New Tab', document: 'Untitled' }
  const item = await window.api.workspaceItems.create({
    taskId,
    type,
    name: names[type],
    url: type === 'browser' ? 'https://google.com' : undefined,
    content: type === 'document' ? '' : undefined
  })
  setItems([...items, item])
  setActiveItemId(item.id)
}

const handleRenameItem = async (id: string, name: string) => {
  const updated = await window.api.workspaceItems.update({ id, name })
  setItems(items.map((i) => (i.id === id ? updated : i)))
}

const handleDeleteItem = async (id: string) => {
  await window.api.workspaceItems.delete(id)
  setItems(items.filter((i) => i.id !== id))
  if (activeItemId === id) setActiveItemId(null)
}
```

Replace sidebar placeholder:
```typescript
<WorkspaceSidebar
  items={items}
  activeItemId={activeItemId}
  onSelectItem={setActiveItemId}
  onAddItem={handleAddItem}
  onRenameItem={handleRenameItem}
  onDeleteItem={handleDeleteItem}
/>
```
  </action>
  <verify>npm run typecheck passes</verify>
  <done>WorkModePage manages items state, sidebar shows real workspace items</done>
</task>

</tasks>

<verification>
- [ ] npm run typecheck passes
- [ ] WorkspaceItemCard shows correct icon per type
- [ ] Context menu allows rename and delete
- [ ] Sidebar shows items and add dropdown
- [ ] WorkModePage loads items from API on mount
</verification>

<success_criteria>
User can add workspace items (chat/browser/document), see them in sidebar, rename via context menu, delete via context menu, and select items to make them active.
</success_criteria>

<output>
After completion, create `.planning/phases/06-work-mode/06-03-SUMMARY.md`
</output>
