---
phase: 06-work-mode
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/shared/types/api.ts
  - src/main/ipc/database.ts
  - src/preload/index.ts
autonomous: true

must_haves:
  truths:
    - "Renderer can create workspace item"
    - "Renderer can fetch workspace items for a task"
    - "Renderer can update workspace item name/content/url"
    - "Renderer can delete workspace item"
  artifacts:
    - path: "src/shared/types/api.ts"
      provides: "CreateWorkspaceItemInput, UpdateWorkspaceItemInput types + ElectronAPI.workspaceItems"
      contains: "workspaceItems:"
    - path: "src/main/ipc/database.ts"
      provides: "IPC handlers for workspace items CRUD"
      contains: "db:workspaceItems:"
    - path: "src/preload/index.ts"
      provides: "Preload bindings for workspaceItems API"
      contains: "workspaceItems:"
  key_links:
    - from: "src/preload/index.ts"
      to: "src/main/ipc/database.ts"
      via: "ipcRenderer.invoke('db:workspaceItems:*')"
      pattern: "db:workspaceItems"
---

<objective>
Add IPC layer for workspace_items CRUD operations.

Purpose: Backend foundation for Work Mode - enables renderer to manage workspace items (chat, browser, document).
Output: workspaceItems API namespace with getByTask/create/update/delete operations.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/shared/types/database.ts
@src/shared/types/api.ts
@src/main/ipc/database.ts
@src/preload/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add workspace item types to api.ts</name>
  <files>src/shared/types/api.ts</files>
  <action>
Add input types for workspace items:

```typescript
export interface CreateWorkspaceItemInput {
  taskId: string
  type: WorkspaceItemType
  name: string
  content?: string  // For documents
  url?: string      // For browser tabs
}

export interface UpdateWorkspaceItemInput {
  id: string
  name?: string
  content?: string
  url?: string
}
```

Import WorkspaceItemType from database.ts.

Add to ElectronAPI interface:
```typescript
workspaceItems: {
  getByTask: (taskId: string) => Promise<WorkspaceItem[]>
  create: (data: CreateWorkspaceItemInput) => Promise<WorkspaceItem>
  update: (data: UpdateWorkspaceItemInput) => Promise<WorkspaceItem>
  delete: (id: string) => Promise<boolean>
}
```

Import WorkspaceItem from database.ts.
  </action>
  <verify>npm run typecheck passes</verify>
  <done>api.ts exports workspace item types and ElectronAPI includes workspaceItems namespace</done>
</task>

<task type="auto">
  <name>Task 2: Add IPC handlers for workspace items</name>
  <files>src/main/ipc/database.ts</files>
  <action>
Import CreateWorkspaceItemInput, UpdateWorkspaceItemInput from api.ts.

Add handlers at end of registerDatabaseHandlers():

```typescript
// Workspace Items
ipcMain.handle('db:workspaceItems:getByTask', (_, taskId: string) => {
  return db.prepare('SELECT * FROM workspace_items WHERE task_id = ? ORDER BY created_at')
    .all(taskId)
})

ipcMain.handle('db:workspaceItems:create', (_, data: CreateWorkspaceItemInput) => {
  const id = crypto.randomUUID()
  db.prepare(`
    INSERT INTO workspace_items (id, task_id, type, name, content, url)
    VALUES (?, ?, ?, ?, ?, ?)
  `).run(id, data.taskId, data.type, data.name, data.content ?? null, data.url ?? null)
  return db.prepare('SELECT * FROM workspace_items WHERE id = ?').get(id)
})

ipcMain.handle('db:workspaceItems:update', (_, data: UpdateWorkspaceItemInput) => {
  const fields: string[] = []
  const values: unknown[] = []

  if (data.name !== undefined) { fields.push('name = ?'); values.push(data.name) }
  if (data.content !== undefined) { fields.push('content = ?'); values.push(data.content) }
  if (data.url !== undefined) { fields.push('url = ?'); values.push(data.url) }

  if (fields.length > 0) {
    fields.push("updated_at = datetime('now')")
    values.push(data.id)
    db.prepare(`UPDATE workspace_items SET ${fields.join(', ')} WHERE id = ?`).run(...values)
  }
  return db.prepare('SELECT * FROM workspace_items WHERE id = ?').get(data.id)
})

ipcMain.handle('db:workspaceItems:delete', (_, id: string) => {
  const result = db.prepare('DELETE FROM workspace_items WHERE id = ?').run(id)
  return result.changes > 0
})
```
  </action>
  <verify>npm run typecheck passes</verify>
  <done>4 IPC handlers registered for workspace items CRUD</done>
</task>

<task type="auto">
  <name>Task 3: Wire preload for workspace items API</name>
  <files>src/preload/index.ts</files>
  <action>
Add workspaceItems namespace to the api object:

```typescript
workspaceItems: {
  getByTask: (taskId) => ipcRenderer.invoke('db:workspaceItems:getByTask', taskId),
  create: (data) => ipcRenderer.invoke('db:workspaceItems:create', data),
  update: (data) => ipcRenderer.invoke('db:workspaceItems:update', data),
  delete: (id) => ipcRenderer.invoke('db:workspaceItems:delete', id)
}
```

Place after chatMessages and before claude.
  </action>
  <verify>npm run typecheck passes</verify>
  <done>window.api.workspaceItems available to renderer</done>
</task>

</tasks>

<verification>
- [ ] npm run typecheck passes
- [ ] ElectronAPI.workspaceItems has getByTask/create/update/delete methods
- [ ] IPC handlers match channel names: db:workspaceItems:{getByTask,create,update,delete}
</verification>

<success_criteria>
Renderer can call window.api.workspaceItems.create/getByTask/update/delete to manage workspace items.
</success_criteria>

<output>
After completion, create `.planning/phases/06-work-mode/06-01-SUMMARY.md`
</output>
